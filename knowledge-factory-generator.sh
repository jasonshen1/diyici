#!/bin/bash
# çŸ¥è¯†æ¶²æ€åŒ–å·¥åŽ‚ - äº¤äº’å¼ç”Ÿæˆå™¨
# æŠŠä»»æ„ç»éªŒè½¬åŒ–ä¸ºå¯å”®å–çš„æŒ‡ä»¤é“¾

clear
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                                                            â•‘"
echo "â•‘         ðŸ­ çŸ¥è¯†æ¶²æ€åŒ–å·¥åŽ‚ - ç»éªŒå°è£…ç”Ÿæˆå™¨                  â•‘"
echo "â•‘                                                            â•‘"
echo "â•‘    æŠŠä¸ªäººç»éªŒ â†’ æ ‡å‡†åŒ–åè®® â†’ å¯å”®å–æ•°å­—èµ„äº§                â•‘"
echo "â•‘                                                            â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# é¢œè‰²å®šä¹‰
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

# æ­¥éª¤1ï¼šç»éªŒè¯†åˆ«
echo -e "${BLUE}ã€æ­¥éª¤1/5ã€‘ç»éªŒè¯†åˆ«${NC}"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
read -p "ä½ çš„ç»éªŒåç§°æ˜¯ä»€ä¹ˆï¼Ÿ (å¦‚ï¼šç½‘ç«™å¿«é€Ÿéƒ¨ç½²) : " EXP_NAME
read -p "ä½ åšè¿‡è¿™ä»¶äº‹å¤šå°‘æ¬¡ï¼Ÿ [æ•°å­—] : " EXP_TIMES
read -p "è¿™ä»¶äº‹å¸®åˆ«äººè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ : " EXP_PROBLEM

echo ""
echo -e "${YELLOW}ç»éªŒç±»åž‹é€‰æ‹©ï¼š${NC}"
echo "1) æµç¨‹åž‹ - æœ‰æ˜Žç¡®æ­¥éª¤ (å¦‚éƒ¨ç½²ã€é…ç½®)"
echo "2) è¯Šæ–­åž‹ - é—®é¢˜å®šä½ (å¦‚æ•…éšœæŽ’æŸ¥)"
echo "3) åˆ›ä½œåž‹ - å†…å®¹ç”Ÿæˆ (å¦‚æ–‡æ¡ˆã€è®¾è®¡)"
echo "4) å†³ç­–åž‹ - æ–¹æ¡ˆé€‰æ‹© (å¦‚é£Žé™©è¯„ä¼°)"
echo "5) æ•´åˆåž‹ - èµ„æºåè°ƒ (å¦‚é¡¹ç›®ç®¡ç†)"
read -p "é€‰æ‹©ç±»åž‹ [1-5] : " EXP_TYPE

case $EXP_TYPE in
    1) TYPE_NAME="æµç¨‹åž‹" ;;
    2) TYPE_NAME="è¯Šæ–­åž‹" ;;
    3) TYPE_NAME="åˆ›ä½œåž‹" ;;
    4) TYPE_NAME="å†³ç­–åž‹" ;;
    5) TYPE_NAME="æ•´åˆåž‹" ;;
    *) TYPE_NAME="æœªåˆ†ç±»" ;;
esac

# æ­¥éª¤2ï¼šä»·å€¼è¯„ä¼°
echo ""
echo -e "${BLUE}ã€æ­¥éª¤2/5ã€‘ä»·å€¼è¯„ä¼°${NC}"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "è¯·ä¸ºä»¥ä¸‹ç»´åº¦æ‰“åˆ† (1-5åˆ†)ï¼š"
read -p "ç¨€ç¼ºæ€§ - å¤šå°‘äººæŽŒæ¡è¿™ä¸ªç»éªŒï¼Ÿ [1-5] : " SCORE_RARE
read -p "éœ€æ±‚é‡ - å¤šå°‘äººéœ€è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ [1-5] : " SCORE_DEMAND
read -p "å¯å¤åˆ¶æ€§ - èƒ½å¦æ ‡å‡†åŒ–äº¤ä»˜ï¼Ÿ [1-5] : " SCORE_COPY
read -p "è‡ªåŠ¨åŒ–ç¨‹åº¦ - AIèƒ½æ›¿ä»£å¤šå°‘ï¼Ÿ [1-5] : " SCORE_AUTO
read -p "æœ‰æ•ˆæœŸ - è¿™ä¸ªç»éªŒèƒ½ç”¨å¤šä¹…ï¼Ÿ [1-5] : " SCORE_LIFE

TOTAL=$((SCORE_RARE + SCORE_DEMAND + SCORE_COPY + SCORE_AUTO + SCORE_LIFE))

echo ""
if [ $TOTAL -ge 15 ]; then
    echo -e "${GREEN}ðŸŸ¢ æ€»è¯„åˆ†: $TOTAL/25 - å€¼å¾—å°è£…ä¸ºäº§å“ï¼${NC}"
    PRODUCT_DECISION="å°è£…ä¸ºå¯å”®å–äº§å“"
elif [ $TOTAL -ge 10 ]; then
    echo -e "${YELLOW}ðŸŸ¡ æ€»è¯„åˆ†: $TOTAL/25 - å°è£…ä¸ºå†…éƒ¨å·¥å…·${NC}"
    PRODUCT_DECISION="å°è£…ä¸ºå†…éƒ¨æ•ˆçŽ‡å·¥å…·"
else
    echo -e "${RED}ðŸ”´ æ€»è¯„åˆ†: $TOTAL/25 - å»ºè®®åªè®°å½•ï¼Œä¸æ·±ç©¶${NC}"
    PRODUCT_DECISION="ç®€å•è®°å½•å³å¯"
fi

# æ­¥éª¤3ï¼šç»“æž„æ‹†è§£
echo ""
echo -e "${BLUE}ã€æ­¥éª¤3/5ã€‘ç»“æž„æ‹†è§£${NC}"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "æˆ‘ä»¬éœ€è¦ä»€ä¹ˆæ‰èƒ½å¼€å§‹ï¼Ÿ"
read -p "å¿…éœ€è¾“å…¥1 : " INPUT_1
read -p "å¿…éœ€è¾“å…¥2 : " INPUT_2
read -p "å¯é€‰è¾“å…¥ (æ²¡æœ‰åˆ™å›žè½¦) : " INPUT_3

echo ""
echo "å…³é”®åˆ¤æ–­ç‚¹ï¼š"
read -p "ç¬¬1ä¸ªåˆ¤æ–­ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ (å¦‚ï¼šæœåŠ¡å™¨æ˜¯å¦æœ‰Node.js) : " DECISION_1
read -p "åˆ¤æ–­åŽçš„åˆ†æ”¯A : " BRANCH_A
read -p "åˆ¤æ–­åŽçš„åˆ†æ”¯B : " BRANCH_B

echo ""
echo "è¾“å‡ºäº¤ä»˜ç‰©ï¼š"
read -p "æ ‡å‡†è¾“å‡º1 : " OUTPUT_1
read -p "æ ‡å‡†è¾“å‡º2 : " OUTPUT_2
read -p "æˆåŠŸæ ‡å‡† (å¦‚ä½•ç®—å®Œæˆäº†) : " SUCCESS_CRITERIA

# æ­¥éª¤4ï¼šç”Ÿæˆæ–‡ä»¶
echo ""
echo -e "${BLUE}ã€æ­¥éª¤4/5ã€‘ç”ŸæˆæŒ‡ä»¤é“¾æ–‡ä»¶${NC}"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# åˆ›å»ºæ–‡ä»¶ç›®å½•
OUTPUT_DIR="$HOME/.openclaw/workspace/protocols/$(echo $EXP_NAME | tr ' ' '-' | tr '[:upper:]' '[:lower:]')"
mkdir -p "$OUTPUT_DIR"

# ç”Ÿæˆç»“æž„æ‹†è§£æ–‡æ¡£
cat > "$OUTPUT_DIR/structure.md" << EOF
# $EXP_NAME - ç»“æž„æ‹†è§£

## å…ƒä¿¡æ¯
- **ç»éªŒåç§°**: $EXP_NAME
- **ç»éªŒç±»åž‹**: $TYPE_NAME
- **åšè¿‡æ¬¡æ•°**: $EXP_TIMES æ¬¡
- **è§£å†³é—®é¢˜**: $EXP_PROBLEM
- **ä»·å€¼è¯„åˆ†**: $TOTAL/25
- **å°è£…å»ºè®®**: $PRODUCT_DECISION
- **åˆ›å»ºæ—¶é—´**: $(date '+%Y-%m-%d')

## è¾“å…¥å±‚
### å¿…éœ€è¾“å…¥
- $INPUT_1
- $INPUT_2

### å¯é€‰è¾“å…¥
- $INPUT_3

## åˆ¤æ–­èŠ‚ç‚¹å±‚
### èŠ‚ç‚¹1: $DECISION_1
- **åˆ†æ”¯A**: $BRANCH_A
- **åˆ†æ”¯B**: $BRANCH_B

## è¾“å‡ºå±‚
### æ ‡å‡†è¾“å‡º
- $OUTPUT_1
- $OUTPUT_2

### æˆåŠŸæ ‡å‡†
$SUCCESS_CRITERIA

## ä¸‹ä¸€æ­¥
- [ ] ç¼–å†™è¯¦ç»†æ‰§è¡Œæ­¥éª¤
- [ ] è®¾è®¡Promptæ¨¡æ¿
- [ ] åˆ›å»ºè‡ªåŠ¨åŒ–è„šæœ¬
- [ ] æµ‹è¯•å¹¶ä¼˜åŒ–
EOF

# ç”ŸæˆPromptæ¨¡æ¿
cat > "$OUTPUT_DIR/prompt-template.md" << EOF
# $EXP_NAME - Promptæ¨¡æ¿

## è§’è‰²å®šä¹‰
ä½ æ˜¯ã€$EXP_NAMEä¸“å®¶ã€‘ï¼Œæ“…é•¿å¿«é€Ÿé«˜æ•ˆåœ°å®Œæˆ$EXP_NAMEä»»åŠ¡ã€‚

## ä»»åŠ¡æè¿°
åŸºäºŽæä¾›çš„è¾“å…¥ä¿¡æ¯ï¼Œå®Œæˆ$EXP_NAMEï¼Œç¡®ä¿ç¬¦åˆæˆåŠŸæ ‡å‡†ã€‚

## è¾“å…¥ä¿¡æ¯
ã€è¾“å…¥1ã€‘: {{INPUT_1}}
ã€è¾“å…¥2ã€‘: {{INPUT_2}}
ã€è¾“å…¥3ã€‘: {{INPUT_3}}

## æ‰§è¡Œæ­¥éª¤
1. éªŒè¯è¾“å…¥å®Œæ•´æ€§
2. æ‰§è¡Œæ ¸å¿ƒæµç¨‹
3. è´¨é‡æ£€æŸ¥
4. ç”Ÿæˆäº¤ä»˜ç‰©

## åˆ¤æ–­é€»è¾‘
- å¦‚æžœ $DECISION_1:
  - æ˜¯ â†’ $BRANCH_A
  - å¦ â†’ $BRANCH_B

## è¾“å‡ºæ ¼å¼
\`\`\`
ã€äº¤ä»˜ç‰©1ã€‘
$OUTPUT_1

ã€äº¤ä»˜ç‰©2ã€‘
$OUTPUT_2

ã€è´¨é‡ç¡®è®¤ã€‘
- [ ] ç¬¦åˆæˆåŠŸæ ‡å‡†: $SUCCESS_CRITERIA
\`\`\`

## æ³¨æ„äº‹é¡¹
- ç¡®ä¿æ‰€æœ‰å¿…éœ€è¾“å…¥å·²æä¾›
- å¦‚æœ‰å¼‚å¸¸åŠæ—¶åé¦ˆ
- è¾“å‡ºå‰è‡ªæ£€è´¨é‡
EOF

# ç”Ÿæˆæ‰§è¡Œè„šæœ¬æ¡†æž¶
cat > "$OUTPUT_DIR/execute.sh" << 'EOF'
#!/bin/bash
# EXP_NAME - è‡ªåŠ¨åŒ–æ‰§è¡Œè„šæœ¬
# ç”Ÿæˆæ—¶é—´: GENERATE_TIME

set -e

# é…ç½®
INPUT_DIR="./inputs"
OUTPUT_DIR="./outputs"
LOG_FILE="./logs/execution.log"

# æ—¥å¿—å‡½æ•°
log() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

# è¾“å…¥éªŒè¯
validate_input() {
    log "éªŒè¯è¾“å…¥..."
    # TODO: æ·»åŠ è¾“å…¥éªŒè¯é€»è¾‘
    if [ ! -f "$INPUT_DIR/input1.txt" ]; then
        log "âŒ ç¼ºå°‘å¿…éœ€è¾“å…¥: input1.txt"
        return 1
    fi
    log "âœ… è¾“å…¥éªŒè¯é€šè¿‡"
}

# æ ¸å¿ƒæ‰§è¡Œ
execute_core() {
    log "æ‰§è¡Œæ ¸å¿ƒæµç¨‹..."
    # TODO: æ·»åŠ æ ¸å¿ƒæ‰§è¡Œé€»è¾‘
    log "âœ… æ ¸å¿ƒæµç¨‹å®Œæˆ"
}

# è´¨é‡æ£€æŸ¥
quality_check() {
    log "è´¨é‡æ£€æŸ¥..."
    # TODO: æ·»åŠ è´¨é‡æ£€æŸ¥é€»è¾‘
    log "âœ… è´¨é‡æ£€æŸ¥é€šè¿‡"
}

# äº¤ä»˜è¾“å‡º
deliver_output() {
    log "ç”Ÿæˆäº¤ä»˜ç‰©..."
    mkdir -p "$OUTPUT_DIR"
    # TODO: å¤åˆ¶è¾“å‡ºæ–‡ä»¶
    log "âœ… äº¤ä»˜ç‰©å·²ç”Ÿæˆåœ¨ $OUTPUT_DIR"
}

# ä¸»æµç¨‹
main() {
    log "========== å¼€å§‹æ‰§è¡Œ: EXP_NAME =========="
    
    validate_input || exit 1
    execute_core || exit 1
    quality_check || exit 1
    deliver_output
    
    log "========== æ‰§è¡Œå®Œæˆ =========="
}

main "$@"
EOF

# æ›¿æ¢è„šæœ¬ä¸­çš„å ä½ç¬¦
sed -i "s/EXP_NAME/$EXP_NAME/g" "$OUTPUT_DIR/execute.sh"
sed -i "s/GENERATE_TIME/$(date '+%Y-%m-%d %H:%M:%S')/g" "$OUTPUT_DIR/execute.sh"
chmod +x "$OUTPUT_DIR/execute.sh"

# ç”Ÿæˆäº¤ä»˜ç‰©æ¸…å•
cat > "$OUTPUT_DIR/deliverables.md" << EOF
# $EXP_NAME - äº¤ä»˜ç‰©æ¸…å•

## æ ¸å¿ƒäº¤ä»˜ç‰©
1. **$OUTPUT_1**
   - æ ¼å¼: [å¾…è¡¥å……]
   - å†…å®¹: [å¾…è¡¥å……]
   - è´¨é‡æ ‡å‡†: $SUCCESS_CRITERIA

2. **$OUTPUT_2**
   - æ ¼å¼: [å¾…è¡¥å……]
   - å†…å®¹: [å¾…è¡¥å……]

## é™„åŠ äº¤ä»˜ç‰©
3. **æ‰§è¡Œæ—¥å¿—**
   - æ ¼å¼: æ–‡æœ¬æ–‡ä»¶
   - å†…å®¹: å®Œæ•´æ‰§è¡Œè¿‡ç¨‹è®°å½•

4. **è´¨é‡æŠ¥å‘Š**
   - æ ¼å¼: Markdown
   - å†…å®¹: æ£€æŸ¥ç»“æžœå’Œç¡®è®¤é¡¹

## äº¤ä»˜æ ‡å‡†
- [ ] æ‰€æœ‰æ ¸å¿ƒäº¤ä»˜ç‰©å·²å®Œæˆ
- [ ] é€šè¿‡è´¨é‡æ£€æŸ¥: $SUCCESS_CRITERIA
- [ ] å®¢æˆ·/ç”¨æˆ·ç¡®è®¤æ»¡æ„
- [ ] ç›¸å…³æ–‡æ¡£å·²å½’æ¡£

## å®šä»·å»ºè®®ï¼ˆå‚è€ƒï¼‰
- å•æ¬¡æœåŠ¡: [å¾…å¡«å†™] å…ƒ
- åŒ…æœˆè®¢é˜…: [å¾…å¡«å†™] å…ƒ
- ä¹°æ–­æŽˆæƒ: [å¾…å¡«å†™] å…ƒ
EOF

echo -e "${GREEN}âœ… æŒ‡ä»¤é“¾æ–‡ä»¶å·²ç”Ÿæˆï¼${NC}"
echo ""
echo "ðŸ“ æ–‡ä»¶ä½ç½®: $OUTPUT_DIR"
echo ""
echo "ç”Ÿæˆçš„æ–‡ä»¶ï¼š"
ls -lh "$OUTPUT_DIR/"

# æ­¥éª¤5ï¼šä¸‹ä¸€æ­¥å»ºè®®
echo ""
echo -e "${BLUE}ã€æ­¥éª¤5/5ã€‘ä¸‹ä¸€æ­¥è¡ŒåŠ¨å»ºè®®${NC}"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "ðŸ“ ç«‹å³è¡ŒåŠ¨ï¼š"
echo "1. å®Œå–„ $OUTPUT_DIR/structure.md ä¸­çš„è¯¦ç»†æ­¥éª¤"
echo "2. æµ‹è¯• $OUTPUT_DIR/prompt-template.md çš„æœ‰æ•ˆæ€§"
echo "3. å®žçŽ° $OUTPUT_DIR/execute.sh ä¸­çš„æ ¸å¿ƒé€»è¾‘"
echo ""
echo "ðŸŽ¯ æœ¬å‘¨ç›®æ ‡ï¼š"
echo "- å®Œæˆ1æ¬¡å…¨æµç¨‹æµ‹è¯•"
echo "- æ”¶é›†åé¦ˆå¹¶ä¼˜åŒ–"
echo "- ç¡®å®šå®šä»·ç­–ç•¥"
echo ""
echo "ðŸ’° å˜çŽ°è·¯å¾„ï¼š"
if [ $TOTAL -ge 15 ]; then
    echo "- ä½œä¸ºæœåŠ¡äº§å“å¯¹å¤–å”®å–"
    echo "- å½•åˆ¶æ•™ç¨‹è§†é¢‘å¼•æµ"
    echo "- å¼€å‘SaaSå·¥å…·ç‰ˆæœ¬"
elif [ $TOTAL -ge 10 ]; then
    echo "- æå‡ä¸ªäººå·¥ä½œæ•ˆçŽ‡"
    echo "- å›¢é˜Ÿå†…éƒ¨æŽ¨å¹¿ä½¿ç”¨"
    echo "- ç§¯ç´¯ç»éªŒåŽå†äº§å“åŒ–"
else
    echo "- ä»…ä½œä¸ºä¸ªäººç¬”è®°ä¿å­˜"
    echo "- ç»§ç»­ç§¯ç´¯æ›´å¤šæ¡ˆä¾‹"
fi

echo ""
echo -e "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo -e "${GREEN}  ðŸŽ‰ çŸ¥è¯†æ¶²æ€åŒ–å®Œæˆï¼${NC}"
echo -e "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo ""
