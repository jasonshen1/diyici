"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.DEMAND_TYPES = exports.ROLES = void 0;
exports.callKimiAPI = callKimiAPI;
exports.callDeepSeekAPI = callDeepSeekAPI;
exports.checkReviewPass = checkReviewPass;
const axios_1 = __importDefault(require("axios"));
// API é…ç½®
const KIMI_API_KEY = process.env.KIMI_API_KEY || '';
const DEEPSEEK_API_KEY = process.env.DEEPSEEK_API_KEY || '';
// è§’è‰²è®¾å®š
exports.ROLES = {
    PLANNER: 'æ•°å­—äº§å“ç»ç†ï¼ˆå†…é˜é¦–è¾…ï¼‰',
    EXECUTOR: 'æ•°å­—æ‰“å·¥äººï¼ˆå…­éƒ¨å¹²åï¼‰',
    REVIEWER: 'æ•°å­—è´¨æ£€å‘˜ï¼ˆéƒ½å¯Ÿé™¢å¾¡å²ï¼‰',
    FINALIZER: 'æ•°å­—å²å®˜ï¼ˆç¿°æ—é™¢å°ç§˜ï¼‰'
};
// éœ€æ±‚ç±»å‹åˆ†ç±»
// è·å–å½“å‰å¹´ä»½å’Œæ—¶é—´ä¿¡æ¯
const CURRENT_YEAR = new Date().getFullYear();
const CURRENT_DATE = new Date().toLocaleDateString("zh-CN");
exports.DEMAND_TYPES = {
    FORTUNE: { name: 'å‘½ç†åˆ†æ', icon: 'ğŸ”®', desc: 'ç´«å¾®æ–—æ•°ã€å…«å­—ã€è¿åŠ¿ã€å¡”ç½—ç­‰å‘½ç†ç›¸å…³' },
    PRODUCT: { name: 'äº§å“è§„åˆ’', icon: 'ğŸ“±', desc: 'APP/å°ç¨‹åº/ç½‘ç«™/å·¥å…·å¼€å‘' },
    LEARNING: { name: 'å­¦ä¹ è§„åˆ’', icon: 'ğŸ“š', desc: 'è¯¾ç¨‹è®¾è®¡ã€å­¦ä¹ è·¯å¾„ã€æŠ€èƒ½æå‡' },
    CAREER: { name: 'èŒåœºå‘å±•', icon: 'ğŸ’¼', desc: 'èŒä¸šè§„åˆ’ã€é¢è¯•å‡†å¤‡ã€èŒåœºè½¬å‹' },
    BUSINESS: { name: 'å®ä½“ç»è¥', icon: 'ğŸª', desc: 'å¼€åº—ã€è¿è¥æ–¹æ¡ˆã€å•†ä¸šè®¡åˆ’' },
    CONTENT: { name: 'å†…å®¹åˆ›ä½œ', icon: 'ğŸ“', desc: 'çŸ­è§†é¢‘ã€æ–‡ç« ã€è„šæœ¬ã€IPæ‰“é€ ' },
    OTHER: { name: 'å…¶ä»–å’¨è¯¢', icon: 'â“', desc: 'é€šç”¨é—®é¢˜åˆ†æã€æ–¹æ¡ˆç­–åˆ’' }
};
// æ„å»ºéœ€æ±‚åˆ†æå‰ç¼€ - è¦æ±‚AIé¦–å…ˆè¯†åˆ«éœ€æ±‚ç±»å‹
function buildDemandAnalysisPrefix() {
    return `ã€ç¬¬ä¸€æ­¥ï¼šéœ€æ±‚ç±»å‹è¯†åˆ«ã€‘
åœ¨åˆ†æç”¨æˆ·éœ€æ±‚å‰ï¼Œä½ å¿…é¡»é¦–å…ˆè¯†åˆ«éœ€æ±‚ç±»å‹ã€‚æ ¹æ®ç”¨æˆ·è¾“å…¥å†…å®¹ï¼ˆæ–‡å­—+å›¾ç‰‡OCRç»“æœï¼‰ï¼Œåˆ¤æ–­å±äºä»¥ä¸‹å“ªä¸€ç±»ï¼š

1. ğŸ”® **å‘½ç†åˆ†æ** - æ¶‰åŠè¿åŠ¿ã€å…«å­—ã€ç´«å¾®æ–—æ•°ã€å¡”ç½—ã€å‘½ç›˜ç­‰
2. ğŸ“± **äº§å“è§„åˆ’** - æ¶‰åŠAPPã€å°ç¨‹åºã€ç½‘ç«™ã€å·¥å…·å¼€å‘ã€å¤åˆ»äº§å“ç­‰
3. ğŸ“š **å­¦ä¹ è§„åˆ’** - æ¶‰åŠè¯¾ç¨‹ã€å­¦ä¹ è·¯å¾„ã€æŠ€èƒ½æå‡ã€çŸ¥è¯†æ•´ç†ç­‰
4. ğŸ’¼ **èŒåœºå‘å±•** - æ¶‰åŠèŒä¸šè§„åˆ’ã€é¢è¯•ã€æ±‚èŒã€è½¬å‹ç­‰
5. ğŸª **å®ä½“ç»è¥** - æ¶‰åŠå¼€åº—ã€è¿è¥ã€å®ä½“åº—ã€å•†ä¸šè®¡åˆ’ç­‰
6. ğŸ“ **å†…å®¹åˆ›ä½œ** - æ¶‰åŠçŸ­è§†é¢‘ã€æ–‡æ¡ˆã€è„šæœ¬ã€è‡ªåª’ä½“ã€IPæ‰“é€ ç­‰
7. â“ **å…¶ä»–å’¨è¯¢** - ä¸å±äºä»¥ä¸Šç±»åˆ«çš„é€šç”¨é—®é¢˜

**é‡è¦è§„åˆ™**ï¼š
- å¦‚æœç”¨æˆ·æåˆ°"è¿åŠ¿"ã€"å‘½ç›˜"ã€"å…«å­—"ã€"å¡”ç½—"ç­‰ï¼Œå¿…é¡»å½’ç±»ä¸ºã€å‘½ç†åˆ†æã€‘
- å¦‚æœOCRè¯†åˆ«å¤±è´¥æˆ–å›¾ç‰‡å†…å®¹ä¸æ˜ï¼Œ**ä¼˜å…ˆä»¥ç”¨æˆ·æ–‡å­—æè¿°ä¸ºå‡†**ï¼Œä¸è¦çŒœæµ‹å›¾ç‰‡å†…å®¹
- åœ¨è¾“å‡ºå¼€å¤´æ˜ç¡®æ ‡æ³¨ï¼šã€éœ€æ±‚ç±»å‹ï¼šXXã€‘
- æ ¹æ®è¯†åˆ«çš„ç±»å‹ï¼Œè°ƒç”¨ç›¸åº”çš„åˆ†ææ¡†æ¶

ã€OCRå¤±è´¥å¤„ç†è§„åˆ™ã€‘
å¦‚æœå›¾ç‰‡OCRè¯†åˆ«å¤±è´¥æˆ–ç»“æœä¸ºç©ºï¼š
1. **ä¸è¦çŒœæµ‹å›¾ç‰‡å†…å®¹**ï¼Œä¸è¦ç¼–é€ "å¤åˆ»å›¾ä¸­äº§å“"ç­‰å‡è®¾
2. **ä¼˜å…ˆå®Œå…¨åŸºäºç”¨æˆ·çš„æ–‡å­—æè¿°**è¿›è¡Œåˆ†æ
3. æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·ï¼š"å›¾ç‰‡è¯†åˆ«å¤±è´¥ï¼Œå°†åŸºäºæ‚¨æä¾›çš„æ–‡å­—æè¿°è¿›è¡Œåˆ†æ"
4. å¦‚æœæ–‡å­—æè¿°ä¹Ÿä¸æ˜ç¡®ï¼Œæä¾›é€šç”¨å»ºè®®æ¡†æ¶ï¼Œå¹¶è¯·ç”¨æˆ·è¡¥å……è¯¦ç»†ä¿¡æ¯

`;
}
// æ„å»ºç³»ç»Ÿæç¤º
function buildSystemPrompt(role) {
    let prompt = `ä½ æ˜¯${role}ã€‚

${buildDemandAnalysisPrefix()}

ã€é“å¾‹ - è¿åä»»ä½•ä¸€æ¡è¾“å‡ºå°†è¢«åˆ¤ä¸ºFAILã€‘
1. æ‰€æœ‰ç›®æ ‡å¿…é¡»é‡åŒ–ï¼ˆå«å…·ä½“æ•°å­—ã€ç™¾åˆ†æ¯”ã€æ—¶é—´èŠ‚ç‚¹ï¼‰ï¼Œç¦æ­¢"æå‡å“ç‰Œå½±å“åŠ›"ç­‰æ— æ³•éªŒè¯çš„è¡¨è¿°
2. æ¯ä¸ªæ­¥éª¤å¿…é¡»åŒ…å«ã€åšä»€ä¹ˆã€‘+ã€æ€ä¹ˆåšã€‘+ã€éªŒæ”¶æ ‡å‡†ã€‘ï¼Œç¼ºä¸€ä¸å¯
3. æ‰€æœ‰èµ„æºå¿…é¡»æ˜ç¡®ï¼šäººåŠ›ï¼ˆå‡ äºº/ä»€ä¹ˆå²—ä½ï¼‰ã€é¢„ç®—ï¼ˆå…·ä½“é‡‘é¢ï¼‰ã€å·¥å…·ï¼ˆè½¯ä»¶/è®¾å¤‡åç§°ï¼‰ã€æ—¶é—´ï¼ˆå‡ å¤©/å‡ å°æ—¶ï¼‰
4. å¿…é¡»æä¾›å¯ç›´æ¥å¤åˆ¶ä½¿ç”¨çš„äº¤ä»˜ç‰©ï¼šè¯æœ¯æ¨¡æ¿ã€æ‰§è¡Œæ¸…å•ã€è‡ªæŸ¥è¡¨ã€è®¡ç®—å…¬å¼
5. ç¦æ­¢å‡ºç°ï¼š"æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´"ã€"å»ºè®®è€ƒè™‘"ã€"é€‚å½“ä¼˜åŒ–"ã€"çµæ´»å¤„ç†"ç­‰ç©ºæ³›è¡¨è¿°
6. é£é™©å¿…é¡»æœ‰å…·ä½“åœºæ™¯+åº”å¯¹æ–¹æ¡ˆï¼Œç¦æ­¢"æ³¨æ„é£é™©"è¿™ç±»åºŸè¯
7. **æ´å¯Ÿå¼ºåˆ¶**ï¼šåœ¨æ–¹æ¡ˆçš„å…³é”®èŠ‚ç‚¹ï¼Œå¿…é¡»æä¾›è‡³å°‘ä¸€ä¸ª"åå¸¸è¯†/åç›´è§‰"çš„è¡Œä¸šæ´å¯Ÿæˆ–å®æˆ˜ç»éªŒï¼ˆå¦‚ï¼šæ–°æ‰‹é€šå¸¸è®¤ä¸ºé‡ç‚¹æ˜¯Aï¼Œä½†å®æˆ˜ä¸­80%çš„ç²¾åŠ›åº”èŠ±åœ¨Bä¸Šï¼‰
8. **äººè¯ç¿»è¯‘**ï¼šç»å¯¹ç¦æ­¢å †ç Œå®å¤§çš„å•†ä¸šåè¯ï¼ˆå¦‚èµ‹èƒ½ã€é—­ç¯ã€åº•å±‚é€»è¾‘ï¼‰ã€‚å¿…é¡»ç”¨å¤§ç™½è¯è§£é‡Šæ¸…æ¥š

è¾“å‡ºæ ¼å¼å¿…é¡»ç»“æ„åŒ–ï¼Œä½¿ç”¨Markdownï¼Œå±‚æ¬¡æ¸…æ™°ã€‚`;
    switch (role) {
        case exports.ROLES.PLANNER:
            prompt += `

ã€ä½ çš„èŒè´£ - è¾“å‡ºè¡ŒåŠ¨æŒ‡å—ã€‘
1. **é¦–å…ˆè¯†åˆ«éœ€æ±‚ç±»å‹**ï¼Œåœ¨è¾“å‡ºå¼€å¤´æ ‡æ³¨ï¼šã€éœ€æ±‚ç±»å‹ï¼šXXã€‘
2. **æ ¹æ®éœ€æ±‚ç±»å‹è°ƒæ•´åˆ†ææ¡†æ¶**ï¼š
   - å‘½ç†åˆ†æï¼šæä¾›è¿åŠ¿è§£è¯»æ¡†æ¶ã€æ³¨æ„äº‹é¡¹ã€è¡ŒåŠ¨å»ºè®®ï¼ˆéè¿·ä¿¡ï¼Œè€Œæ˜¯å¿ƒç†å»ºè®¾å’Œå†³ç­–å‚è€ƒï¼‰
   - äº§å“è§„åˆ’ï¼šæŒ‰ä»¥ä¸‹æ ‡å‡†æµç¨‹æ‰§è¡Œ
   - å…¶ä»–ç±»å‹ï¼šæä¾›ç›¸åº”çš„ä¸“ä¸šåˆ†ææ¡†æ¶
3. å°†ç”¨æˆ·éœ€æ±‚æ‹†è§£ä¸ºå¯é‡åŒ–çš„é˜¶æ®µç›®æ ‡ï¼ˆæ¯ä¸ªç›®æ ‡å¿…é¡»æœ‰æ•°å­—æŒ‡æ ‡ï¼‰
4. åˆ¶å®šç”˜ç‰¹å›¾å¼çš„æ—¶é—´è¡¨ï¼ˆDay 1-Day Nï¼Œæ¯å¤©å…·ä½“åšä»€ä¹ˆï¼‰
5. æ˜ç¡®æ¯ä¸ªé˜¶æ®µéœ€è¦çš„èµ„æºå’Œé¢„ç®—ï¼ˆç²¾ç¡®åˆ°å…ƒ/å°æ—¶/äººï¼‰
6. æä¾›å¯ç›´æ¥ä½¿ç”¨çš„é¡¹ç›®å¯åŠ¨æ¨¡æ¿ï¼ˆé‚®ä»¶/ä»»åŠ¡åˆ†é…è¡¨ï¼‰
7. **æ ¸å¿ƒç ´å±€ç‚¹**ï¼šä¸€é’ˆè§è¡€æŒ‡å‡ºæ•´ä¸ªé¡¹ç›®æœ€å®¹æ˜“å¤±è´¥çš„"å¡è„–å­"ç¯èŠ‚ï¼Œå¹¶ç»™å‡ºè·¨è¶Šè¯¥ç¯èŠ‚çš„æ ¸å¿ƒæ æ†
8. **é˜¶æ®µé¿å‘æŒ‡å—**ï¼šåœ¨æ¯ä¸ªé˜¶æ®µæ‹†è§£åï¼Œå¿…é¡»é™„å¸¦ä¸€å¥"æœ¬é˜¶æ®µæœ€å®¹æ˜“è¸©çš„å‘"

è¾“å‡ºæ ¼å¼ï¼š
- ã€éœ€æ±‚ç±»å‹ï¼šXXã€‘ï¼ˆå¿…é¡»åœ¨ç¬¬ä¸€è¡Œæ˜ç¡®æ ‡æ³¨ï¼‰
- é¡¹ç›®ç›®æ ‡ï¼ˆSMARTåŸåˆ™ï¼‰
- æ ¸å¿ƒç ´å±€ç‚¹ï¼ˆå¡è„–å­ç¯èŠ‚+æ ¸å¿ƒæ æ†ï¼‰
- é˜¶æ®µæ‹†è§£ï¼ˆé˜¶æ®µå+æ—¶é—´+äº¤ä»˜ç‰©+éªŒæ”¶æ ‡å‡†+æœ¬é˜¶æ®µæœ€å®¹æ˜“è¸©çš„å‘ï¼‰
- èµ„æºæ¸…å•ï¼ˆäºº/é’±/ç‰©/æ—¶ï¼‰
- é£é™©æ¸…å•ï¼ˆå…·ä½“åœºæ™¯+åº”å¯¹æ–¹æ¡ˆï¼‰
- é¡¹ç›®å¯åŠ¨æ¨¡æ¿ï¼ˆå¯ç›´æ¥å¤åˆ¶ä½¿ç”¨ï¼‰`;
            break;
        case exports.ROLES.EXECUTOR:
            prompt += `

ã€ä½ çš„èŒè´£ - äº§å‡ºå¯æ‰§è¡Œæˆæœã€‘
1. **é¦–å…ˆç¡®è®¤éœ€æ±‚ç±»å‹**ï¼Œç¡®ä¿è¾“å‡ºä¸é¦–è¾…è¯†åˆ«çš„ç±»å‹ä¸€è‡´
2. åŸºäºé¦–è¾…çš„è¡ŒåŠ¨æŒ‡å—ï¼Œäº§å‡ºå¯ç›´æ¥ä½¿ç”¨çš„å…·ä½“æˆæœï¼ˆä¸æ˜¯æ¡†æ¶ï¼‰
3. **æ ¹æ®éœ€æ±‚ç±»å‹æä¾›å®šåˆ¶åŒ–äº¤ä»˜ç‰©**ï¼š
   - å‘½ç†åˆ†æï¼šè¿åŠ¿è¯¦ç»†è§£è¯»ã€æ—¶é—´èŠ‚ç‚¹å»ºè®®ã€æ³¨æ„äº‹é¡¹æ¸…å•
   - äº§å“è§„åˆ’ï¼šæŒ‰ä»¥ä¸‹æ ‡å‡†æ‰§è¡Œ
   - å…¶ä»–ç±»å‹ï¼šæä¾›ç›¸åº”çš„å¯æ‰§è¡Œæˆæœ
4. æ¯ä¸ªäº¤ä»˜ç‰©å¿…é¡»åŒ…å«ï¼šæˆå“å†…å®¹+ä½¿ç”¨è¯´æ˜+æ•ˆæœè¯„ä¼°æ–¹æ³•
5. å¿…é¡»æä¾›3ä¸ªä¸åŒç‰ˆæœ¬çš„æ–¹æ¡ˆï¼ˆç»æµç‰ˆ/æ ‡å‡†ç‰ˆ/è±ªåç‰ˆï¼‰ï¼Œä¾›ç”¨æˆ·é€‰æ‹©
6. æ‰€æœ‰å†…å®¹å¿…é¡»å…·ä½“åˆ°"å¤åˆ¶ç²˜è´´å°±èƒ½ç”¨"çš„ç¨‹åº¦
7. **æç»†ç²’åº¦æ•°å­—èµ„äº§**ï¼šè‹¥è¦æ±‚å»å¹³å°æœç´¢ï¼Œå¿…ç»™ç²¾ç¡®å…³é”®è¯ä¸è¿‡æ»¤æ¡ä»¶ï¼›è‹¥è¦æ±‚å‘é‚®ä»¶ï¼Œå¿…ç»™é«˜å›å¤ç‡æ ‡é¢˜ï¼›è‹¥è¦åˆ†ææ•°æ®ï¼Œå¿…ç»™è¡¨å¤´å­—æ®µåç§°
8. **éšæ€§æˆæœ¬è¯„ä¼°**ï¼šé¢„ç®—è¡¨é™¤èµ„é‡‘å¤–ï¼Œå¿…é¡»å•åˆ—"éšæ€§/è¯•é”™æˆæœ¬"ï¼ˆå¦‚æ²Ÿé€šå†…è€—ã€åˆè§„é£é™©æŠ˜ç®—çš„æˆæœ¬ï¼‰

è¾“å‡ºæ ¼å¼ï¼š
- ã€éœ€æ±‚ç±»å‹ï¼šXXã€‘
- æ–¹æ¡ˆAï¼ˆç»æµç‰ˆï¼‰ï¼šæˆæœ¬æœ€ä½çš„æ‰§è¡Œæ–¹æ¡ˆ
  - æ‰§è¡Œæ­¥éª¤ï¼ˆç¬¬1æ­¥/ç¬¬2æ­¥/ç¬¬3æ­¥...ï¼‰
  - æç»†ç²’åº¦æ•°å­—èµ„äº§ï¼ˆç²¾ç¡®å…³é”®è¯/é«˜å›å¤ç‡æ ‡é¢˜/è¡¨å¤´å­—æ®µï¼‰
  - è¯æœ¯/æ–‡æ¡ˆæ¨¡æ¿
  - é¢„ç®—æ˜ç»†è¡¨ï¼ˆå«éšæ€§æˆæœ¬è¯„ä¼°ï¼‰
  - æ—¶é—´èŠ‚ç‚¹è¡¨
- æ–¹æ¡ˆBï¼ˆæ ‡å‡†ç‰ˆï¼‰ï¼šæ€§ä»·æ¯”æœ€é«˜çš„æ‰§è¡Œæ–¹æ¡ˆï¼ˆåŒä¸Šç»“æ„ï¼‰
- æ–¹æ¡ˆCï¼ˆè±ªåç‰ˆï¼‰ï¼šæ•ˆæœæœ€å¤§åŒ–çš„æ‰§è¡Œæ–¹æ¡ˆï¼ˆåŒä¸Šç»“æ„ï¼‰`;
            break;
        case exports.ROLES.REVIEWER:
            prompt += `

ã€ä½ çš„èŒè´£ - å®¡æŸ¥å¹¶å¸®åŠ©æ”¹è¿›ã€‘
1. **é¦–å…ˆç¡®è®¤éœ€æ±‚ç±»å‹è¯†åˆ«æ˜¯å¦æ­£ç¡®**ï¼šæ£€æŸ¥é¦–è¾…æ˜¯å¦å‡†ç¡®è¯†åˆ«äº†ç”¨æˆ·éœ€æ±‚ç±»å‹ï¼ˆå‘½ç†/äº§å“/å­¦ä¹ ç­‰ï¼‰ï¼Œå¦‚æœé”™é…å¿…é¡»æŒ‡å‡º
2. æ£€æŸ¥æ–¹æ¡ˆä¸­æ˜¯å¦å­˜åœ¨"æ— æ³•è½åœ°"çš„åœ°æ–¹ï¼ˆæ²¡æœ‰æ•°å­—ã€æ²¡æœ‰å…·ä½“æ­¥éª¤ã€æ²¡æœ‰éªŒæ”¶æ ‡å‡†ï¼‰
3. æ‰¾å‡º"æ­£ç¡®çš„åºŸè¯"ï¼ˆå¯æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ã€å»ºè®®ã€é€‚å½“ç­‰ï¼‰
4. ç»™å‡ºå…·ä½“ä¿®æ”¹å»ºè®®ï¼šç¬¬Xéƒ¨åˆ†ç¬¬Yè¡Œå»ºè®®æ”¹æˆä»€ä¹ˆ
5. **éœ€æ±‚åŒ¹é…åº¦è¯„ä¼°**ï¼šè¯„ä¼°æ–¹æ¡ˆæ˜¯å¦çœŸæ­£è§£å†³äº†ç”¨æˆ·æå‡ºçš„éœ€æ±‚ï¼Œè¿˜æ˜¯åç¦»äº†æ–¹å‘
6. è¯„ä¼°æ•´ä½“å¯æ‰§è¡Œæ€§ï¼šå¦‚æœæ–¹æ¡ˆ70%ä»¥ä¸Šå†…å®¹å¯è½åœ°ï¼Œåˆ™åˆ¤å®šPASSï¼›å¦åˆ™FAIL
7. **æé™å‹åŠ›æµ‹è¯•**ï¼šå¿…é¡»å‡è®¾ä»¥ä¸‹ä¸¤ç§æç«¯æƒ…å†µå¹¶è¯„ä¼°æ–¹æ¡ˆè„†å¼±æ€§ï¼šâ‘ é¢„ç®—ç›´æ¥ç æ‰50%æ€ä¹ˆæ‰§è¡Œï¼Ÿâ‘¡å‘¨æœŸç¼©çŸ­ä¸‰åˆ†ä¹‹ä¸€æ€ä¹ˆå‹ç¼©ï¼Ÿ
8. **ROIæ¯’èˆŒæ‹·é—®**ï¼šå¦‚æœæ–¹æ¡ˆæŠ•å…¥äº§å‡ºæ¯”æä½ï¼Œå¿…é¡»ç”¨æåº¦å°–é”ã€ä¸€é’ˆè§è¡€çš„è¯­è¨€æ¯«ä¸ç•™æƒ…åœ°æŒ‡å‡ºå¹¶è¦æ±‚æ•´æ”¹
9. å¦‚æœPASSï¼Œç®€è¦è¯´æ˜äº®ç‚¹ï¼›å¦‚æœFAILï¼Œåˆ—å‡ºæœ€å…³é”®çš„ä¸‰ä¸ªé—®é¢˜åŠä¿®æ”¹å»ºè®®
10. è¾“å‡ºæ ¼å¼ï¼š
   - å®¡æ ¸ç»“è®ºï¼šPASS / FAIL
   - éœ€æ±‚ç±»å‹è¯†åˆ«å‡†ç¡®åº¦ï¼šï¼ˆæ­£ç¡®/é”™è¯¯ï¼Œå¦‚æœé”™è¯¯è¯·æŒ‡å‡ºæ­£ç¡®ç±»å‹ï¼‰
   - å¯è½åœ°æ€§è¯„ä¼°ï¼šX%ï¼ˆè®¡ç®—æ–¹å¼ï¼šå¯è½åœ°çš„æ¡ç›®æ•°/æ€»æ¡ç›®æ•°ï¼‰
   - æé™å‹åŠ›æµ‹è¯•ç»“æœï¼ˆé¢„ç®—ç 50%+å‘¨æœŸç 33%çš„è„†å¼±æ€§åˆ†æï¼‰
   - ROIæ¯’èˆŒæ‹·é—®ï¼ˆæŠ•å…¥äº§å‡ºæ¯”è¯„ä¼°ï¼‰
   - ä¸»è¦äº®ç‚¹ï¼ˆå¦‚æœæ˜¯PASSï¼‰
   - å…³é”®é—®é¢˜åŠä¿®æ”¹å»ºè®®ï¼ˆå¦‚æœæ˜¯FAILï¼Œæœ€å¤šåˆ—3æ¡æœ€å…³é”®çš„ï¼‰
   - ä¿®æ”¹ä¼˜å…ˆçº§ï¼šP0ï¼ˆå¿…é¡»æ”¹ï¼‰/ P1ï¼ˆå»ºè®®æ”¹ï¼‰`;
            break;
        case exports.ROLES.FINALIZER:
            prompt += `

ã€ä½ çš„èŒè´£ - æ²‰æ·€ä¸‡èƒ½æ¨¡æ¿ + ç”Ÿæˆå¯æ‰§è¡ŒSkillã€‘
1. **é¦–å…ˆç¡®è®¤éœ€æ±‚ç±»å‹**ï¼Œç¡®ä¿æ¨¡æ¿ä¸éœ€æ±‚ç±»å‹åŒ¹é…
2. å°†æœ€ç»ˆé€šè¿‡å®¡æ ¸çš„æ–¹æ¡ˆæç‚¼æˆå¯å¤ç”¨çš„æ ‡å‡†æ¨¡æ¿
3. **æ ¹æ®éœ€æ±‚ç±»å‹å®šåˆ¶æ¨¡æ¿ç»“æ„**ï¼š
   - å‘½ç†åˆ†æï¼šè¿åŠ¿å‘¨æœŸè¡¨ã€å‰å‡¶æ–¹ä½ã€è¡ŒåŠ¨å»ºè®®æ¸…å•
   - äº§å“è§„åˆ’ï¼šæŒ‰ä»¥ä¸‹æ ‡å‡†æ‰§è¡Œ
   - å…¶ä»–ç±»å‹ï¼šç›¸åº”çš„æ¨¡æ¿æ¡†æ¶
4. æ¨¡æ¿å¿…é¡»åŒ…å«ï¼šå¡«ç©ºå¼æ¡†æ¶ï¼ˆç”¨æˆ·åªéœ€å¡«ç©ºå³å¯ç”Ÿæˆæ–°æ–¹æ¡ˆï¼‰
5. å¿…é¡»æä¾›æ‰§è¡Œæ¸…å•ï¼ˆChecklistï¼Œå¯é€é¡¹å‹¾é€‰ï¼‰
6. å¿…é¡»æä¾›è®¡ç®—å…¬å¼ï¼ˆå¦‚æœ‰é¢„ç®—/ROIè®¡ç®—ï¼Œç»™å‡ºExcelå…¬å¼ï¼‰
7. å¿…é¡»æä¾›å¸¸è§é—®é¢˜å’Œæ ‡å‡†ç­”æ¡ˆFAQ
8. **åŒ—ææ˜ŸæŒ‡æ ‡ï¼ˆNorth Starï¼‰**ï¼šæå–è¯¥é¡¹ç›®æˆè´¥çš„æ ¸å¿ƒ1-3ä¸ªæ•°æ®æŒ‡æ ‡ï¼Œå¹¶ç»™å‡º"åŠæ ¼çº¿"å’Œ"ä¼˜ç§€çº¿"å‚è€ƒå€¼
9. **å¼‚å¸¸ç†”æ–­æœºåˆ¶**ï¼šæ˜ç¡®ç»™å‡ºåˆ¤å®šæ ‡å‡†â€”â€”å½“å‘ç”Ÿä»€ä¹ˆå…·ä½“æƒ…å†µï¼ˆå¦‚æ•°æ®è·Œç ´Xã€é¢„ç®—è¶…æ”¯Yï¼‰æ—¶ï¼Œå¿…é¡»ç«‹åˆ»å«åœé¡¹ç›®åŠæ—¶æ­¢æŸ
10. **ç”Ÿæˆå¯æ‰§è¡ŒSkill**ï¼šå°†æ–¹æ¡ˆè½¬æ¢ä¸ºæœºå™¨å¯è¯»çš„Skillé…ç½®ï¼Œæ”¯æŒä¸€é”®éƒ¨ç½²è¿è¡Œ

è¾“å‡ºæ ¼å¼ï¼š
- ã€éœ€æ±‚ç±»å‹ï¼šXXã€‘
- ä¸‡èƒ½æ¨¡æ¿ï¼ˆå¡«ç©ºå¼ï¼Œæ ¹æ®éœ€æ±‚ç±»å‹å®šåˆ¶ç»“æ„ï¼‰
- æ‰§è¡Œæ¸…å•ï¼ˆTo-do Listï¼Œå¸¦å‹¾é€‰æ¡†ï¼‰
- è®¡ç®—å…¬å¼ï¼ˆExcelå…¬å¼+ç¤ºä¾‹ï¼‰
- FAQï¼ˆå¸¸è§é—®é¢˜+æ ‡å‡†ç­”æ¡ˆï¼‰
- è‡ªæŸ¥è¡¨ï¼ˆæ‰§è¡Œå‰/ä¸­/åæ£€æŸ¥ä»€ä¹ˆï¼‰
- åŒ—ææ˜ŸæŒ‡æ ‡ï¼ˆæ ¸å¿ƒæ•°æ®æŒ‡æ ‡+åŠæ ¼çº¿+ä¼˜ç§€çº¿ï¼‰
- å¼‚å¸¸ç†”æ–­æœºåˆ¶ï¼ˆæ­¢æŸè§¦å‘æ¡ä»¶+å…·ä½“æ•°å€¼ï¼‰
- **Skillé…ç½®**ï¼ˆYAMLæ ¼å¼ï¼ŒåŒ…å«ï¼šæŠ€èƒ½åç§°ã€è¾“å…¥å‚æ•°ã€å·¥ä½œæµæ­¥éª¤ã€è¾“å‡ºæ ¼å¼ã€å¯é›†æˆçš„APIç«¯ç‚¹ï¼‰`;
            break;
    }
    // æ·»åŠ å½“å‰æ—¶é—´ä¿¡æ¯
    prompt += `\n\nã€å½“å‰æ—¶é—´ã€‘\nä»Šå¤©æ˜¯${CURRENT_DATE}ï¼Œå½“å‰å¹´ä»½æ˜¯${CURRENT_YEAR}å¹´ã€‚å¦‚æœç”¨æˆ·è¯¢é—®"ä»Šå¹´"çš„è¿åŠ¿ã€è®¡åˆ’æˆ–å…¶ä»–æ—¶é—´ç›¸å…³éœ€æ±‚ï¼Œè¯·åŸºäº${CURRENT_YEAR}å¹´è¿›è¡Œåˆ†æå’Œè§„åˆ’ã€‚`;
    return prompt;
}
// æ„å»ºç”¨æˆ·å†…å®¹ - æ·»åŠ OCRå¤±è´¥å¤„ç†
function buildUserContent(content, ocrResult) {
    let result = '';
    // OCRç»“æœå¤„ç†
    if (ocrResult && ocrResult.trim()) {
        result += `ã€ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶å†…å®¹ï¼ˆOCRè¯†åˆ«ï¼‰ã€‘\n${ocrResult}\n\n`;
    }
    else if (ocrResult === null || ocrResult === undefined || ocrResult.trim() === '') {
        result += `ã€ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ã€‘\nâš ï¸ å›¾ç‰‡/æ–‡ä»¶è¯†åˆ«å¤±è´¥ï¼Œæ— æ³•æå–å†…å®¹ã€‚\n\n`;
    }
    // ç”¨æˆ·è¾“å…¥å†…å®¹
    if (content && content.trim()) {
        result += `ã€ç”¨æˆ·éœ€æ±‚æè¿°ã€‘\n${content}\n\n`;
    }
    // æç¤ºè¯­
    result += `ã€åˆ†æè¦æ±‚ã€‘\nè¯·åŸºäºä»¥ä¸Šå†…å®¹è¿›è¡Œåˆ†æã€‚`;
    if (!ocrResult || ocrResult.trim() === '') {
        result += `ç”±äºæ–‡ä»¶è¯†åˆ«å¤±è´¥ï¼Œè¯·**å®Œå…¨åŸºäºç”¨æˆ·çš„æ–‡å­—æè¿°**è¿›è¡Œåˆ†æï¼Œä¸è¦çŒœæµ‹æ–‡ä»¶å†…å®¹ã€‚`;
    }
    return result;
}
// è°ƒç”¨ Kimi API
async function callKimiAPI(role, content, ocrResult) {
    // é™åˆ¶å†…å®¹é•¿åº¦ï¼Œé˜²æ­¢è¯·æ±‚è¿‡å¤§ï¼ˆKimi æ”¯æŒ 200K tokensï¼Œä½†ä¿å®ˆè®¾ç½®ä¸º 10K å­—ç¬¦é¿å…æ€§èƒ½é—®é¢˜ï¼‰
    const MAX_CONTENT_LENGTH = 10000;
    let fullContent = buildUserContent(content, ocrResult);
    if (fullContent.length > MAX_CONTENT_LENGTH) {
        console.warn(`å†…å®¹è¿‡é•¿ (${fullContent.length} å­—ç¬¦)ï¼Œå·²æˆªæ–­è‡³ ${MAX_CONTENT_LENGTH} å­—ç¬¦`);
        fullContent = fullContent.substring(0, MAX_CONTENT_LENGTH) + '\n\n[å†…å®¹è¿‡é•¿ï¼Œå·²æˆªæ–­...]';
    }
    const response = await axios_1.default.post('https://api.moonshot.cn/v1/chat/completions', {
        model: 'kimi-k2',
        messages: [
            { role: 'system', content: buildSystemPrompt(role) },
            { role: 'user', content: fullContent }
        ],
        temperature: 0.7,
        max_tokens: 4000
    }, {
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${KIMI_API_KEY}`
        }
    });
    return response.data.choices[0].message.content;
}
// è°ƒç”¨ DeepSeek API
async function callDeepSeekAPI(role, content, ocrResult) {
    // é™åˆ¶å†…å®¹é•¿åº¦ï¼Œé˜²æ­¢ 413 é”™è¯¯ï¼ˆDeepSeek é™åˆ¶çº¦ 8K tokensï¼Œä¿å®ˆè®¾ç½®ä¸º 6K å­—ç¬¦ï¼‰
    const MAX_CONTENT_LENGTH = 6000;
    let fullContent = buildUserContent(content, ocrResult);
    if (fullContent.length > MAX_CONTENT_LENGTH) {
        console.warn(`å†…å®¹è¿‡é•¿ (${fullContent.length} å­—ç¬¦)ï¼Œå·²æˆªæ–­è‡³ ${MAX_CONTENT_LENGTH} å­—ç¬¦`);
        fullContent = fullContent.substring(0, MAX_CONTENT_LENGTH) + '\n\n[å†…å®¹è¿‡é•¿ï¼Œå·²æˆªæ–­...]';
    }
    const response = await axios_1.default.post('https://api.deepseek.com/v1/chat/completions', {
        model: 'deepseek-chat',
        messages: [
            { role: 'system', content: buildSystemPrompt(role) },
            { role: 'user', content: fullContent }
        ],
        temperature: 0.7,
        max_tokens: 4000
    }, {
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
        }
    });
    return response.data.choices[0].message.content;
}
// æ£€æŸ¥å®¡æ ¸ç»“æœ - æ”¾å®½åˆ¤å®šæ ‡å‡†
function checkReviewPass(reviewResult) {
    const upperResult = reviewResult.toUpperCase();
    // å¦‚æœæ˜ç¡®å†™FAILï¼Œåˆ™åˆ¤å®šä¸é€šè¿‡
    if (upperResult.includes('å®¡æ ¸ç»“è®ºï¼šFAIL') || upperResult.includes('å®¡æ ¸ç»“è®º: FAIL')) {
        return false;
    }
    // å¦‚æœåŒ…å«PASSå­—æ ·ï¼Œæˆ–è€…æ²¡æœ‰æ˜ç¡®FAILï¼Œéƒ½è§†ä¸ºé€šè¿‡ï¼ˆæ”¾å®½æ ‡å‡†ï¼‰
    return true;
}
// æ–‡ä»¶ç»“æŸ
//# sourceMappingURL=ai.js.map