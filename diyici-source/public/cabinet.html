<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>æ•°å­—å†…é˜ - ä½ çš„ä¸“å±å››äººæ™ºèƒ½å›¢é˜Ÿ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'PingFang SC', 'Microsoft YaHei', sans-serif;
      background: linear-gradient(135deg, #1a1a3e 0%, #0f0f23 100%);
      min-height: 100vh;
      color: #e2e8f0;
      line-height: 1.6;
    }
    
    .container {
      max-width: 900px;
      margin: 40px auto;
      padding: 40px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 50% 50%, rgba(102, 126, 234, 0.1) 0%, transparent 60%),
        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.1) 0%, transparent 50%);
      pointer-events: none;
    }
    
    .header {
      text-align: center;
      margin-bottom: 40px;
      position: relative;
      z-index: 1;
    }
    
    .brand-name {
      font-size: 36px;
      font-weight: 800;
      background: linear-gradient(135deg, #667eea 0%, #f093fb 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
      letter-spacing: 2px;
    }
    
    .page-title {
      font-size: 28px;
      font-weight: 700;
      color: #fff;
      margin-bottom: 16px;
    }
    
    .page-subtitle {
      font-size: 16px;
      color: #94a3b8;
      max-width: 600px;
      margin: 0 auto;
    }
    
    .input-section {
      margin-bottom: 40px;
      position: relative;
      z-index: 1;
    }
    
    .input-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    
    label {
      display: block;
      font-weight: 600;
      color: #fff;
      font-size: 16px;
    }
    
    .input-hint {
      font-size: 14px;
      color: #64748b;
    }
    
    textarea {
      width: 100%;
      padding: 20px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      resize: vertical;
      min-height: 200px;
      font-size: 16px;
      font-family: inherit;
      color: #e2e8f0;
      transition: all 0.3s ease;
    }
    
    textarea:focus {
      outline: none;
      border-color: rgba(102, 126, 234, 0.5);
      box-shadow: 0 0 20px rgba(102, 126, 234, 0.2);
    }
    
    textarea::placeholder {
      color: #64748b;
    }
    
    .button-group {
      display: flex;
      gap: 16px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    
    button {
      flex: 1;
      min-width: 200px;
      padding: 16px 32px;
      border-radius: 30px;
      font-size: 16px;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.3s;
      cursor: pointer;
      border: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(102, 126, 234, 0.5);
    }
    
    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: #e2e8f0;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.3);
    }
    
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }
    
    .progress-section {
      margin: 40px 0;
      padding: 30px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      position: relative;
      z-index: 1;
    }
    
    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .progress-header h3 {
      font-size: 18px;
      font-weight: 700;
      color: #fff;
    }
    
    .progress-status {
      font-size: 14px;
      color: #64748b;
    }
    
    .progress-bar {
      width: 100%;
      height: 12px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      overflow: hidden;
      margin: 20px 0;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea, #764ba2);
      border-radius: 6px;
      transition: width 0.5s ease;
      position: relative;
    }
    
    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      animation: shimmer 2s infinite;
    }
    
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    .status-text {
      font-size: 16px;
      color: #94a3b8;
      text-align: center;
      margin-top: 16px;
    }
    
    .result-section {
      margin-top: 40px;
      padding-top: 30px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      position: relative;
      z-index: 1;
    }
    
    .result-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .result-header h3 {
      font-size: 20px;
      font-weight: 700;
      color: #fff;
      margin-bottom: 8px;
    }
    
    .result-header p {
      font-size: 14px;
      color: #64748b;
    }
    
    .result-card {
      margin: 20px 0;
      padding: 24px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .result-card:hover {
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(102, 126, 234, 0.3);
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
    }
    
    .result-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea, #764ba2);
    }
    
    .result-card h4 {
      font-size: 18px;
      font-weight: 700;
      color: #fff;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .result-card h4::before {
      content: '';
      width: 4px;
      height: 16px;
      background: linear-gradient(180deg, #667eea, #764ba2);
      border-radius: 2px;
    }
    
    .result-content {
      font-size: 16px;
      line-height: 1.7;
      white-space: pre-wrap;
      word-break: break-word;
      color: #e2e8f0;
    }
    
    .error-message {
      color: #f87171;
      margin-top: 16px;
      padding: 16px;
      background: rgba(248, 113, 113, 0.1);
      border-radius: 8px;
      border: 1px solid rgba(248, 113, 113, 0.2);
      position: relative;
      z-index: 1;
    }
    
    .success-message {
      color: #34d399;
      margin-top: 16px;
      padding: 16px;
      background: rgba(52, 211, 153, 0.1);
      border-radius: 8px;
      border: 1px solid rgba(52, 211, 153, 0.2);
      position: relative;
      z-index: 1;
    }
    
    .back-link {
      display: inline-block;
      margin-top: 30px;
      color: #667eea;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s ease;
      font-size: 14px;
    }
    
    .back-link:hover {
      color: #764ba2;
      text-decoration: underline;
    }
    
    /* Workflow Steps Styles */
    .workflow-step {
      margin-bottom: 16px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s ease;
    }
    
    .workflow-step:hover {
      background: rgba(255, 255, 255, 0.05);
      transform: translateX(4px);
    }
    
    .workflow-step.active {
      border-color: rgba(102, 126, 234, 0.5);
      background: rgba(102, 126, 234, 0.1);
    }
    
    .workflow-step.completed {
      border-color: rgba(76, 175, 80, 0.5);
      background: rgba(76, 175, 80, 0.05);
    }
    
    .workflow-step.failed {
      border-color: rgba(244, 67, 54, 0.5);
      background: rgba(244, 67, 54, 0.05);
    }
    
    .step-header {
      display: flex;
      align-items: center;
      gap: 16px;
      cursor: pointer;
    }
    
    .step-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 20px;
      color: #fff;
      flex-shrink: 0;
    }
    
    .step-icon.planning {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .step-icon.execution {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }
    
    .step-icon.review {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }
    
    .step-icon.archive {
      background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    }
    
    .step-info {
      flex: 1;
    }
    
    .step-info h4 {
      font-size: 16px;
      font-weight: 600;
      color: #fff;
      margin-bottom: 4px;
    }
    
    .step-desc {
      font-size: 13px;
      color: #94a3b8;
    }
    
    .step-status {
      font-size: 13px;
      font-weight: 500;
      padding: 6px 12px;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.1);
      color: #94a3b8;
      white-space: nowrap;
    }
    
    .workflow-step.active .step-status {
      background: rgba(102, 126, 234, 0.3);
      color: #667eea;
      animation: pulse 2s infinite;
    }
    
    .workflow-step.completed .step-status {
      background: rgba(76, 175, 80, 0.3);
      color: #4caf50;
    }
    
    .workflow-step.failed .step-status {
      background: rgba(244, 67, 54, 0.3);
      color: #f44336;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    
    .step-content {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      display: none;
    }
    
    .workflow-step.active .step-content {
      display: block;
    }
    
    .thinking-box, .output-box {
      margin-bottom: 16px;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .thinking-header, .output-header {
      padding: 12px 16px;
      font-weight: 600;
      font-size: 14px;
    }
    
    .thinking-header {
      background: rgba(255, 193, 7, 0.2);
      color: #ffc107;
    }
    
    .output-header {
      background: rgba(76, 175, 80, 0.2);
      color: #4caf50;
    }
    
    .thinking-content, .output-content {
      padding: 16px;
      background: rgba(0, 0, 0, 0.2);
      font-size: 14px;
      line-height: 1.7;
      white-space: pre-wrap;
      max-height: 300px;
      overflow-y: auto;
    }
    
    /* Responsive Styles */
    @media (max-width: 768px) {
      .container {
        margin: 20px;
        padding: 30px;
        border-radius: 12px;
      }
      
      .brand-name {
        font-size: 28px;
      }
      
      .page-title {
        font-size: 24px;
      }
      
      .button-group {
        flex-direction: column;
      }
      
      button {
        width: 100%;
        min-width: unset;
      }
      
      textarea {
        min-height: 150px;
        padding: 16px;
      }
      
      .progress-section {
        padding: 20px;
      }
      
      .result-card {
        padding: 20px;
      }
    }
    
    /* Small Mobile */
    @media (max-width: 480px) {
      .container {
        margin: 10px;
        padding: 20px;
      }
      
      .brand-name {
        font-size: 24px;
      }
      
      .page-title {
        font-size: 20px;
      }
      
      .page-subtitle {
        font-size: 14px;
      }
      
      textarea {
        min-height: 120px;
        font-size: 14px;
      }
      
      button {
        padding: 14px 24px;
        font-size: 15px;
      }
      
      .progress-section {
        padding: 16px;
      }
      
      .result-card {
        padding: 16px;
      }
      
      .result-card h4 {
        font-size: 16px;
      }
      
      .result-content {
        font-size: 14px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="brand-name">æ•°å­—å†…é˜</div>
      <h1 class="page-title">ä½ çš„ä¸“å±å››äººAIå›¢é˜Ÿ</h1>
      <p class="page-subtitle">ç¬¬ä¸€æ¬¡æŠŠæ‰åç³»ç»ŸåŒ–æˆä¸ºå¼€åˆ›è€…ï¼Œä½ çš„ä¸“å±å››äººAIå†…é˜</p>
    </div>
    
    <!-- æ•°å­—å†…é˜ä»‹ç» -->
    <div class="cabinet-intro" style="margin-bottom: 40px; position: relative; z-index: 1;">
      <h2 style="font-size: 20px; font-weight: 700; color: #fff; margin-bottom: 24px; text-align: center;">æ•°å­—å†…é˜å·¥ä½œæµç¨‹</h2>
      <p style="text-align: center; color: #94a3b8; margin-bottom: 32px;">å››ä¸ªAIè§’è‰²äº’ç›¸åˆ¶çº¦ã€äº’ç›¸åä½œï¼Œä¸ºä½ å®Œæˆä»è§„åˆ’åˆ°æ‰§è¡Œçš„å…¨æµç¨‹</p>
      
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; margin-bottom: 24px;">
        <!-- è°‹å±€è€… -->
        <div style="padding: 24px; background: rgba(255, 255, 255, 0.05); border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.1); text-align: center; transition: all 0.3s ease;">
          <div style="margin-bottom: 16px;">
            <img src="https://trae-api-cn.mchost.guru/api/ide/v1/text_to_image?prompt=smart%20business%20consultant%20analyzing%20data%20charts%2C%20wearing%20formal%20attire%2C%20modern%20flat%20design%2C%20dark%20purple%20background%2C%20professional%20corporate%20style&image_size=square" alt="è°‹å±€è€…" style="width: 80px; height: 80px; object-fit: contain;">
          </div>
          <h3 style="font-size: 16px; font-weight: 700; color: #fff; margin-bottom: 12px;">è°‹å±€è€…ï¼ˆé¦–è¾…ï¼‰</h3>
          <p style="font-size: 13px; color: #94a3b8; line-height: 1.5;">åˆ†æç”¨æˆ·éœ€æ±‚ï¼Œåˆ¶å®šè¯¦ç»†çš„è¡ŒåŠ¨æŒ‡å—ï¼Œæ˜ç¡®ä»»åŠ¡ç›®æ ‡ã€æ­¥éª¤å’Œé¢„æœŸæˆæœã€‚</p>
        </div>
        
        <!-- æ‰§è¡Œè€… -->
        <div style="padding: 24px; background: rgba(255, 255, 255, 0.05); border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.1); text-align: center; transition: all 0.3s ease;">
          <div style="margin-bottom: 16px;">
            <img src="https://trae-api-cn.mchost.guru/api/ide/v1/text_to_image?prompt=efficient%20project%20manager%20executing%20tasks%2C%20holding%20checklist%2C%20dynamic%20action%20pose%2C%20modern%20flat%20design%2C%20dark%20purple%20background%2C%20professional%20style&image_size=square" alt="æ‰§è¡Œè€…" style="width: 80px; height: 80px; object-fit: contain;">
          </div>
          <h3 style="font-size: 16px; font-weight: 700; color: #fff; margin-bottom: 12px;">æ‰§è¡Œè€…ï¼ˆå¹²åï¼‰</h3>
          <p style="font-size: 13px; color: #94a3b8; line-height: 1.5;">æ ¹æ®è¡ŒåŠ¨æŒ‡å—æ‰§è¡Œä»»åŠ¡ï¼Œç”Ÿæˆé«˜è´¨é‡çš„åˆç‰ˆæˆæœï¼Œç¡®ä¿æˆæœç¬¦åˆç”¨æˆ·éœ€æ±‚ã€‚</p>
        </div>
        
        <!-- æ‰¾èŒ¬è€… -->
        <div style="padding: 24px; background: rgba(255, 255, 255, 0.05); border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.1); text-align: center; transition: all 0.3s ease;">
          <div style="margin-bottom: 16px;">
            <img src="https://trae-api-cn.mchost.guru/api/ide/v1/text_to_image?prompt=strict%20quality%20inspector%20with%20magnifying%20glass%2C%20reviewing%20documents%2C%20critical%20analysis%2C%20modern%20flat%20design%2C%20dark%20purple%20background%2C%20professional%20style&image_size=square" alt="æ‰¾èŒ¬è€…" style="width: 80px; height: 80px; object-fit: contain;">
          </div>
          <h3 style="font-size: 16px; font-weight: 700; color: #fff; margin-bottom: 12px;">æ‰¾èŒ¬è€…ï¼ˆå¾¡å²ï¼‰</h3>
          <p style="font-size: 13px; color: #94a3b8; line-height: 1.5;">ä¸¥æ ¼å®¡æ ¸æäº¤çš„æˆæœï¼Œæ‰¾å‡ºé—®é¢˜å’Œä¸è¶³ï¼Œç»™å‡ºè¯¦ç»†çš„å®¡æ ¸æŠ¥å‘Šï¼Œæœ€ç»ˆåšå‡ºè£å†³ï¼šé€šè¿‡æˆ–ä¸é€šè¿‡ã€‚</p>
        </div>
      </div>
      
      <!-- æ²‰æ·€è€…å•ç‹¬ä¸€è¡Œ -->
      <div style="display: grid; grid-template-columns: 1fr; gap: 24px; margin-bottom: 32px;">
        <!-- æ²‰æ·€è€… -->
        <div style="padding: 24px; background: rgba(255, 255, 255, 0.05); border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.1); text-align: center; transition: all 0.3s ease;">
          <div style="margin-bottom: 16px;">
            <img src="https://trae-api-cn.mchost.guru/api/ide/v1/text_to_image?prompt=knowledge%20archivist%20organizing%20documents%2C%20creating%20reports%2C%20summarizing%20information%2C%20modern%20flat%20design%2C%20dark%20purple%20background%2C%20professional%20style&image_size=square" alt="æ²‰æ·€è€…" style="width: 80px; height: 80px; object-fit: contain;">
          </div>
          <h3 style="font-size: 16px; font-weight: 700; color: #fff; margin-bottom: 12px;">æ²‰æ·€è€…ï¼ˆå²å®˜ï¼‰</h3>
          <p style="font-size: 13px; color: #94a3b8; line-height: 1.5;">æ€»ç»“æ•´ä¸ªæµç¨‹ï¼Œæå–å…³é”®ä¿¡æ¯ï¼Œç”Ÿæˆå¯å¤ç”¨çš„ä¸‡èƒ½æ¨¡æ¿ï¼Œç¡®ä¿æ¨¡æ¿ç»“æ„æ¸…æ™°ã€å†…å®¹å®Œæ•´ã€‚</p>
        </div>
      </div>
      
      <!-- å·¥ä½œæµç¨‹ -->
      <div style="padding: 24px; background: rgba(255, 255, 255, 0.05); border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.1); margin-bottom: 32px;">
        <h3 style="font-size: 18px; font-weight: 700; color: #fff; margin-bottom: 16px; text-align: center;">å·¥ä½œæµç¨‹</h3>
        <div style="display: flex; flex-direction: column; gap: 12px;">
          <div style="display: flex; align-items: center; gap: 12px;">
            <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px;">1</div>
            <p style="color: #e2e8f0; flex: 1;"><span style="font-weight: 600; color: #fff;">æäº¤éœ€æ±‚</span> - è¾“å…¥æ‚¨çš„å…·ä½“éœ€æ±‚ï¼Œè¶Šè¯¦ç»†è¶Šå¥½</p>
          </div>
          <div style="display: flex; align-items: center; gap: 12px;">
            <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px;">2</div>
            <p style="color: #e2e8f0; flex: 1;"><span style="font-weight: 600; color: #fff;">è°‹å±€è€…åˆ†æ</span> - åˆ¶å®šè¯¦ç»†çš„è¡ŒåŠ¨æŒ‡å—</p>
          </div>
          <div style="display: flex; align-items: center; gap: 12px;">
            <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px;">3</div>
            <p style="color: #e2e8f0; flex: 1;"><span style="font-weight: 600; color: #fff;">æ‰§è¡Œè€…æ‰§è¡Œ</span> - æ ¹æ®æŒ‡å—ç”Ÿæˆåˆç‰ˆæˆæœ</p>
          </div>
          <div style="display: flex; align-items: center; gap: 12px;">
            <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px;">4</div>
            <p style="color: #e2e8f0; flex: 1;"><span style="font-weight: 600; color: #fff;">æ‰¾èŒ¬è€…å®¡æ ¸</span> - ä¸¥æ ¼å®¡æ ¸å¹¶æå‡ºæ”¹è¿›æ„è§</p>
          </div>
          <div style="display: flex; align-items: center; gap: 12px;">
            <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px;">5</div>
            <p style="color: #e2e8f0; flex: 1;"><span style="font-weight: 600; color: #fff;">æ²‰æ·€è€…æ€»ç»“</span> - ç”Ÿæˆå¯å¤ç”¨çš„ä¸‡èƒ½æ¨¡æ¿</p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="input-section">
      <div class="input-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
        <label for="user-input">è¯·æè¿°æ‚¨çš„éœ€æ±‚</label>
        <div style="display: flex; align-items: center; gap: 8px;">
          <label id="strict-mode-label" style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 13px; color: #94a3b8;">
            <input type="checkbox" id="strict-mode" style="accent-color: #667eea;">
            <span>ğŸ”’ ä¸¥æ ¼æ¨¡å¼</span>
          </label>
          <span class="tooltip" title="ä¸¥æ ¼æ¨¡å¼ä¼šå¼ºåˆ¶AIè¾“å‡ºï¼š1.é‡åŒ–ç›®æ ‡ 2.å…·ä½“æ­¥éª¤ 3.æ˜ç¡®èµ„æº 4.é£é™©æ§åˆ¶ 5.ç¦æ­¢ç©ºè¯" style="color: #64748b; cursor: help;">â“˜</span>
        </div>
      </div>
      <!-- ä¸¥æ ¼æ¨¡å¼è¯´æ˜ -->
      <div id="strict-mode-info" style="display: none; background: rgba(102, 126, 234, 0.1); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 8px; padding: 12px; margin-bottom: 12px; font-size: 12px; color: #e2e8f0;">
        <strong style="color: #fbbf24;">ğŸ“‹ ä¸¥æ ¼æ¨¡å¼å·²å¼€å¯ï¼ŒAIå°†è¢«å¼ºåˆ¶è¦æ±‚ï¼š</strong>
        <ul style="margin: 8px 0 0 16px; color: #94a3b8; line-height: 1.8;">
          <li>æ‰€æœ‰ç›®æ ‡å¿…é¡»<strong style="color: #fbbf24;">é‡åŒ–</strong>ï¼ˆå…·ä½“æ•°å­—ã€ç™¾åˆ†æ¯”ã€æ—¶é—´èŠ‚ç‚¹ï¼‰</li>
          <li>æ¯ä¸ªæ­¥éª¤å¿…é¡»åŒ…å«ã€åšä»€ä¹ˆã€‘+ã€æ€ä¹ˆåšã€‘+<strong style="color: #fbbf24;">ã€éªŒæ”¶æ ‡å‡†ã€‘</strong></li>
          <li>èµ„æºæ˜ç¡®ï¼šäººåŠ›ï¼ˆå‡ äººï¼‰ã€é¢„ç®—ï¼ˆå¤šå°‘é’±ï¼‰ã€å·¥å…·ï¼ˆä»€ä¹ˆè½¯ä»¶ï¼‰ã€æ—¶é—´ï¼ˆå‡ å¤©ï¼‰</li>
          <li>é£é™©å¿…é¡»æœ‰ï¼šå…·ä½“é—®é¢˜ + åº”å¯¹æ–¹æ¡ˆ</li>
          <li>ç¦æ­¢å‡ºç°"å»ºè®®è€ƒè™‘""é€‚å½“ä¼˜åŒ–"ç­‰ç©ºæ³›è¡¨è¿°</li>
          <li>å¿…é¡»æä¾›å¯ç›´æ¥ä½¿ç”¨çš„<strong style="color: #fbbf24;">è¯æœ¯/æ¨¡æ¿/è‡ªæŸ¥è¡¨</strong></li>
        </ul>
      </div>
      <span class="input-hint">æ”¯æŒä¸Šä¼ å›¾ç‰‡ã€PDFã€Word ç­‰æ–‡ä»¶ï¼Œæˆ–ç›´æ¥åœ¨ä¸‹æ–¹è¾“å…¥æ–‡æœ¬</span>
      
      <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
      <div class="file-upload-section" style="margin-bottom: 16px;">
        <div class="file-upload-area" id="file-upload-area" style="border: 2px dashed rgba(102, 126, 234, 0.5); border-radius: 12px; padding: 24px; text-align: center; background: rgba(102, 126, 234, 0.05); cursor: pointer; transition: all 0.3s ease;">
          <div class="upload-icon" style="font-size: 48px; margin-bottom: 12px;">ğŸ“</div>
          <p style="color: #94a3b8; margin-bottom: 8px;">ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ </p>
          <p style="color: #64748b; font-size: 12px;">æ”¯æŒï¼šå›¾ç‰‡ã€PDFã€Wordã€TXTã€Markdown</p>
          <p style="color: #94a3b8; font-size: 11px; margin-top: 6px;">âš ï¸ å•ä¸ªæ–‡ä»¶æœ€å¤§ 10MB</p>
          <input type="file" id="file-input" style="display: none;" accept=".pdf,.doc,.docx,.txt,.md,image/*" multiple>
        </div>
        
        <!-- å·²ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨ -->
        <div id="file-list" style="margin-top: 12px; display: none;">
          <p style="color: #94a3b8; font-size: 12px; margin-bottom: 8px;">å·²ä¸Šä¼ æ–‡ä»¶ï¼š</p>
          <div id="file-items" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
        </div>
      </div>
      
      <textarea id="user-input" placeholder="è¯·è¯¦ç»†æè¿°æ‚¨çš„éœ€æ±‚ï¼Œæˆ–ä¸Šä¼ æ–‡ä»¶ååœ¨æ­¤è¡¥å……è¯´æ˜...">ä¸ºæˆ‘çš„çº¿ä¸Šè¯¾ç¨‹ã€Šæ•°æ®åˆ†æå…¥é—¨åˆ°ç²¾é€šã€‹è®¾è®¡ä¸€ä¸ªå®Œæ•´çš„æ¨å¹¿æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ç›®æ ‡å—ä¼—åˆ†æã€æ¨å¹¿æ¸ é“é€‰æ‹©ã€å†…å®¹ç­–ç•¥å’Œè½¬åŒ–ä¼˜åŒ–æ–¹æ¡ˆ</textarea>
      
      <div class="button-group">
        <button id="submit-btn" class="btn-primary">
          <span>å¼€å§‹æ‰§è¡Œ</span>
        </button>
        <button id="reset-btn" class="btn-secondary">
          <span>é‡ç½®</span>
        </button>
      </div>
    </div>
    
    <div class="progress-section" style="display: none;">
      <div class="progress-header">
        <h3>æ‰§è¡Œè¿›åº¦</h3>
        <span class="progress-status" id="progress-percentage">0%</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" style="width: 0%;"></div>
      </div>
      <div class="status-text" id="status-text">å‡†å¤‡ä¸­...</div>
      
      <!-- å®æ—¶å·¥ä½œæµç¨‹å±•ç¤º -->
      <div id="workflow-visualization" style="margin-top: 32px;">
        <!-- è°‹å±€è€… -->
        <div class="workflow-step" id="step-planning" data-step="planning">
          <div class="step-header">
            <div class="step-icon planning">è°‹</div>
            <div class="step-info">
              <h4>è°‹å±€è€…ï¼ˆé¦–è¾…ï¼‰æ­£åœ¨åˆ†æ...</h4>
              <p class="step-desc">æ‹†è§£éœ€æ±‚ï¼Œåˆ¶å®šè¡ŒåŠ¨æŒ‡å—</p>
            </div>
            <div class="step-status">â³ è¿›è¡Œä¸­</div>
          </div>
          <div class="step-content" style="display: none;">
            <div class="thinking-box">
              <div class="thinking-header">æ€è€ƒè¿‡ç¨‹</div>
              <div class="thinking-content" id="planning-thinking">æ­£åœ¨åˆ†ææ‚¨çš„éœ€æ±‚...</div>
            </div>
            <div class="output-box">
              <div class="output-header">è¡ŒåŠ¨æŒ‡å—</div>
              <div class="output-content" id="planning-output">ç­‰å¾…ç”Ÿæˆ...</div>
            </div>
          </div>
        </div>
        
        <!-- æ‰§è¡Œè€… -->
        <div class="workflow-step" id="step-execution" data-step="execution">
          <div class="step-header">
            <div class="step-icon execution">æ‰§</div>
            <div class="step-info">
              <h4>æ‰§è¡Œè€…ï¼ˆå¹²åï¼‰æ­£åœ¨å¹²æ´»...</h4>
              <p class="step-desc">æŒ‰ç…§æŒ‡å—äº§å‡ºåˆç‰ˆæˆæœ</p>
            </div>
            <div class="step-status">â¸ï¸ ç­‰å¾…ä¸­</div>
          </div>
          <div class="step-content" style="display: none;">
            <div class="thinking-box">
              <div class="thinking-header">æ‰§è¡Œæ€è·¯</div>
              <div class="thinking-content" id="execution-thinking">ç­‰å¾…å¯åŠ¨...</div>
            </div>
            <div class="output-box">
              <div class="output-header">åˆç‰ˆæˆæœ</div>
              <div class="output-content" id="execution-output">ç­‰å¾…ç”Ÿæˆ...</div>
            </div>
          </div>
        </div>
        
        <!-- æ‰¾èŒ¬è€… -->
        <div class="workflow-step" id="step-review" data-step="review">
          <div class="step-header">
            <div class="step-icon review">æŸ¥</div>
            <div class="step-info">
              <h4>æ‰¾èŒ¬è€…ï¼ˆå¾¡å²ï¼‰æ­£åœ¨å®¡æ ¸...</h4>
              <p class="step-desc">ä¸¥æ ¼æ£€æŸ¥ï¼Œå‘ç°é—®é¢˜</p>
            </div>
            <div class="step-status">â¸ï¸ ç­‰å¾…ä¸­</div>
          </div>
          <div class="step-content" style="display: none;">
            <div class="thinking-box">
              <div class="thinking-header">å®¡æ ¸å‘ç°</div>
              <div class="thinking-content" id="review-thinking">ç­‰å¾…å®¡æ ¸...</div>
            </div>
            <div class="output-box">
              <div class="output-header">å®¡æ ¸æŠ¥å‘Š</div>
              <div class="output-content" id="review-output">ç­‰å¾…ç”Ÿæˆ...</div>
            </div>
          </div>
        </div>
        
        <!-- æ²‰æ·€è€… -->
        <div class="workflow-step" id="step-archive" data-step="archive">
          <div class="step-header">
            <div class="step-icon archive">è®°</div>
            <div class="step-info">
              <h4>æ²‰æ·€è€…ï¼ˆå²å®˜ï¼‰æ­£åœ¨æ€»ç»“...</h4>
              <p class="step-desc">æå–æ¨¡æ¿ï¼Œæ²‰æ·€ç»éªŒ</p>
            </div>
            <div class="step-status">â¸ï¸ ç­‰å¾…ä¸­</div>
          </div>
          <div class="step-content" style="display: none;">
            <div class="thinking-box">
              <div class="thinking-header">ç»éªŒæ€»ç»“</div>
              <div class="thinking-content" id="archive-thinking">ç­‰å¾…æ€»ç»“...</div>
            </div>
            <div class="output-box">
              <div class="output-header">ä¸‡èƒ½æ¨¡æ¿</div>
              <div class="output-content" id="archive-output">ç­‰å¾…ç”Ÿæˆ...</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="result-section" style="display: none;">
      <div class="result-header">
        <h3>æ‰§è¡Œç»“æœ</h3>
        <p>æ•°å­—å†…é˜å·²å®Œæˆæ‚¨çš„éœ€æ±‚ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†æ‰§è¡Œè¿‡ç¨‹</p>
      </div>
      <div id="result-container"></div>
      <a href="/" class="back-link">â† è¿”å›é¦–é¡µ</a>
    </div>
  </div>
  
  <script>
    // å…¨å±€é”™è¯¯å¤„ç†
    window.onerror = function(msg, url, line) {
      console.error("JSé”™è¯¯:", msg, "è¡Œ:", line);
      alert("é¡µé¢é”™è¯¯: " + msg + " (è¡Œ: " + line + ")");
    };
    const submitBtn = document.getElementById('submit-btn');
    const resetBtn = document.getElementById('reset-btn');
    const userInput = document.getElementById('user-input');
    const progressSection = document.querySelector('.progress-section');
    const progressFill = document.querySelector('.progress-fill');
    const progressPercentage = document.getElementById('progress-percentage');
    const statusText = document.getElementById('status-text');
    const resultSection = document.querySelector('.result-section');
    const resultContainer = document.getElementById('result-container');
    
    // ä¸¥æ ¼æ¨¡å¼ç›¸å…³
    const strictModeCheckbox = document.getElementById('strict-mode');
    const strictModeInfo = document.getElementById('strict-mode-info');
    const strictModeLabel = document.getElementById('strict-mode-label');
    
    // ç›‘å¬ä¸¥æ ¼æ¨¡å¼å˜åŒ–
    strictModeCheckbox.addEventListener('change', () => {
      if (strictModeCheckbox.checked) {
        strictModeInfo.style.display = 'block';
        strictModeLabel.style.color = '#fbbf24';
      } else {
        strictModeInfo.style.display = 'none';
        strictModeLabel.style.color = '#94a3b8';
      }
    });
    
    // æ–‡ä»¶ä¸Šä¼ ç›¸å…³
    const fileUploadArea = document.getElementById('file-upload-area');
    const fileInput = document.getElementById('file-input');
    const fileList = document.getElementById('file-list');
    const fileItems = document.getElementById('file-items');
    const uploadedFiles = [];
    
    // æ–‡ä»¶ä¸Šä¼ ç‚¹å‡»äº‹ä»¶
    fileUploadArea.addEventListener('click', () => {
      fileInput.click();
    });
    
    // æ‹–æ‹½ä¸Šä¼ 
    fileUploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      fileUploadArea.style.borderColor = '#667eea';
      fileUploadArea.style.background = 'rgba(102, 126, 234, 0.1)';
    });
    
    fileUploadArea.addEventListener('dragleave', () => {
      fileUploadArea.style.borderColor = 'rgba(102, 126, 234, 0.5)';
      fileUploadArea.style.background = 'rgba(102, 126, 234, 0.05)';
    });
    
    fileUploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      fileUploadArea.style.borderColor = 'rgba(102, 126, 234, 0.5)';
      fileUploadArea.style.background = 'rgba(102, 126, 234, 0.05)';
      
      const files = Array.from(e.dataTransfer.files);
      handleFiles(files);
    });
    
    // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
    fileInput.addEventListener('change', (e) => {
      console.log('æ–‡ä»¶é€‰æ‹©äº‹ä»¶è§¦å‘ï¼Œæ–‡ä»¶æ•°é‡:', e.target.files.length);
      const files = Array.from(e.target.files);
      if (files.length > 0) {
        handleFiles(files);
      }
      // é‡ç½® input ä»¥ä¾¿å¯ä»¥å†æ¬¡é€‰æ‹©åŒä¸€æ–‡ä»¶
      e.target.value = '';
    });
    
    // å¤„ç†æ–‡ä»¶
    function handleFiles(files) {
      console.log('å¤„ç†æ–‡ä»¶:', files.length, 'ä¸ªæ–‡ä»¶');
      files.forEach(file => {
        console.log('å¤„ç†æ–‡ä»¶:', file.name, 'ç±»å‹:', file.type, 'å¤§å°:', file.size);
        
        // æ£€æŸ¥æ–‡ä»¶ç±»å‹
        const allowedTypes = [
          'image/*', 'application/pdf', 
          'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
          'text/plain', 'text/markdown'
        ];
        
        const isAllowed = allowedTypes.some(type => {
          if (type.endsWith('/*')) {
            return file.type.startsWith(type.replace('/*', ''));
          }
          return file.type === type;
        });
        
        // é€šè¿‡åç¼€åå†æ£€æŸ¥ä¸€æ¬¡ï¼ˆæŸäº›è®¾å¤‡å¯èƒ½ä¸è¿”å› typeï¼‰
        const allowedExtensions = ['.pdf', '.doc', '.docx', '.txt', '.md', '.jpg', '.jpeg', '.png', '.gif', '.webp'];
        const hasAllowedExt = allowedExtensions.some(ext => file.name.toLowerCase().endsWith(ext));
        
        if (!isAllowed && !hasAllowedExt) {
          alert('âŒ ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: ' + file.name + '\n\næ”¯æŒç±»å‹ï¼šå›¾ç‰‡ã€PDFã€Wordã€TXTã€Markdown');
          return;
        }
        
        // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆæœ€å¤§ 10MBï¼‰
        if (file.size > 10 * 1024 * 1024) {
          const sizeMB = (file.size / (1024 * 1024)).toFixed(1);
          alert('âŒ æ–‡ä»¶è¿‡å¤§\n\næ–‡ä»¶å: ' + file.name + '\næ–‡ä»¶å¤§å°: ' + sizeMB + ' MB\nå¤§å°é™åˆ¶: 10 MB\n\nè¯·å‹ç¼©å›¾ç‰‡æˆ–é€‰æ‹©æ›´å°çš„æ–‡ä»¶ã€‚');
          return;
        }
        
        // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨åŒåæ–‡ä»¶
        const existingIndex = uploadedFiles.findIndex(f => f.name === file.name);
        if (existingIndex > -1) {
          uploadedFiles[existingIndex] = file;
          // é‡æ–°æ¸²æŸ“æ–‡ä»¶åˆ—è¡¨
          fileItems.innerHTML = '';
          uploadedFiles.forEach(f => displayFile(f));
        } else {
          uploadedFiles.push(file);
          displayFile(file);
        }
      });
      
      fileList.style.display = 'block';
      console.log('å½“å‰ä¸Šä¼ æ–‡ä»¶æ€»æ•°:', uploadedFiles.length);
    }
    
    // æ˜¾ç¤ºæ–‡ä»¶
    function displayFile(file) {
      const fileItem = document.createElement('div');
      fileItem.style.cssText = 'display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: rgba(102, 126, 234, 0.1); border-radius: 8px; font-size: 12px;';
      
      const icon = getFileIcon(file.type);
      
      // åˆ›å»ºæ–‡ä»¶ä¿¡æ¯å…ƒç´ 
      const iconSpan = document.createElement('span');
      iconSpan.textContent = icon;
      
      const nameSpan = document.createElement('span');
      nameSpan.style.cssText = 'color: #e2e8f0; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;';
      nameSpan.textContent = file.name;
      
      const sizeSpan = document.createElement('span');
      sizeSpan.style.cssText = 'color: #64748b;';
      sizeSpan.textContent = `(${(file.size / 1024).toFixed(1)} KB)`;
      
      const removeBtn = document.createElement('button');
      removeBtn.style.cssText = 'background: none; border: none; color: #ef4444; cursor: pointer; font-size: 14px;';
      removeBtn.textContent = 'Ã—';
      removeBtn.onclick = () => removeFile(file.name);
      
      fileItem.appendChild(iconSpan);
      fileItem.appendChild(nameSpan);
      fileItem.appendChild(sizeSpan);
      fileItem.appendChild(removeBtn);
      
      fileItems.appendChild(fileItem);
    }
    
    // è·å–æ–‡ä»¶å›¾æ ‡
    function getFileIcon(type) {
      if (type.startsWith('image/')) return 'ğŸ–¼ï¸';
      if (type === 'application/pdf') return 'ğŸ“„';
      if (type.includes('word')) return 'ğŸ“';
      if (type === 'text/plain' || type === 'text/markdown') return 'ğŸ“ƒ';
      return 'ğŸ“';
    }
    
    // ç§»é™¤æ–‡ä»¶
    window.removeFile = function(fileName) {
      const index = uploadedFiles.findIndex(f => f.name === fileName);
      if (index > -1) {
        uploadedFiles.splice(index, 1);
        fileItems.innerHTML = '';
        uploadedFiles.forEach(f => displayFile(f));
        if (uploadedFiles.length === 0) {
          fileList.style.display = 'none';
        }
      }
    };
    
    // æå–æ–‡ä»¶å†…å®¹
    async function extractFileContent(file, retryCount = 0) {
      return new Promise(async (resolve) => {
        try {
          // å›¾ç‰‡æ–‡ä»¶ - è°ƒç”¨åç«¯ OCR æœåŠ¡
          if (file.type.startsWith('image/')) {
          try {
            const formData = new FormData();
            formData.append('file', file);
            
            // å¢åŠ è¶…æ—¶å¤„ç†
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 30000); // 30ç§’è¶…æ—¶
            
            const response = await fetch('https://diyici.ai/api/ocr/recognize', {
              method: 'POST',
              body: formData,
              signal: controller.signal
            });
            
            clearTimeout(timeoutId);
            
            const result = await response.json();
            
            if (result.success && result.text && result.text.trim()) {
              resolve('[å›¾ç‰‡æ–‡ä»¶: ' + file.name + ']\nâœ… è¯†åˆ«æˆåŠŸï¼ˆ' + (result.service || 'OCR') + 'ï¼‰\nè¯†åˆ«æ–‡å­—ï¼š\n' + result.text);
            } else if (result.success) {
              // OCRæˆåŠŸä½†ç»“æœä¸ºç©ºï¼Œå°è¯•é‡è¯•ä¸€æ¬¡
              if (retryCount < 1) {
                console.log('OCRç»“æœä¸ºç©ºï¼Œé‡è¯•ä¸­... (' + (retryCount + 1) + '/2)');
                setTimeout(() => {
                  extractFileContent(file, retryCount + 1).then(resolve);
                }, 1000);
                return;
              }
              resolve('[å›¾ç‰‡æ–‡ä»¶: ' + file.name + ']\nâš ï¸ OCRè¯†åˆ«ç»“æœä¸ºç©ºï¼Œå¯èƒ½æ˜¯å›¾ç‰‡ä¸­æ²¡æœ‰æ–‡å­—æˆ–æ–‡å­—ä¸æ¸…æ™°ã€‚\nè¯·æ‰‹åŠ¨æè¿°å›¾ç‰‡å†…å®¹');
            } else {
              // è¯†åˆ«å¤±è´¥ï¼Œå°è¯•é‡è¯•ä¸€æ¬¡
              if (retryCount < 1) {
                console.log('OCRå¤±è´¥ï¼Œé‡è¯•ä¸­... (' + (retryCount + 1) + '/2)');
                setTimeout(() => {
                  extractFileContent(file, retryCount + 1).then(resolve);
                }, 1000);
                return;
              }
              resolve('[å›¾ç‰‡æ–‡ä»¶: ' + file.name + ']\nâŒ OCRè¯†åˆ«å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯') + '\nè¯·æ‰‹åŠ¨æè¿°å›¾ç‰‡å†…å®¹');
            }
          } catch (error) {
            // è¯·æ±‚å¤±è´¥ï¼Œå°è¯•é‡è¯•ä¸€æ¬¡
            if (retryCount < 1) {
              console.log('OCRè¯·æ±‚å¤±è´¥ï¼Œé‡è¯•ä¸­... (' + (retryCount + 1) + '/2)');
              setTimeout(() => {
                extractFileContent(file, retryCount + 1).then(resolve);
              }, 1000);
              return;
            }
            resolve('[å›¾ç‰‡æ–‡ä»¶: ' + file.name + ']\nâŒ OCRæœåŠ¡è¿æ¥å¤±è´¥: ' + error.message + '\nè¯·æ‰‹åŠ¨æè¿°å›¾ç‰‡å†…å®¹');
          }
          return;
        }
        
        // PDF æ–‡ä»¶
        if (file.type === 'application/pdf') {
          resolve('[PDFæ–‡ä»¶: ' + file.name + ']\næ–‡ä»¶å¤§å°: ' + (file.size / 1024).toFixed(1) + ' KB\n\næ³¨ï¼šPDF å†…å®¹æå–éœ€è¦åç«¯æ”¯æŒã€‚å½“å‰æ‚¨å¯ä»¥æ‰‹åŠ¨ç²˜è´´ PDF ä¸­çš„å…³é”®å†…å®¹ã€‚');
          return;
        }
        
        // Word æ–‡ä»¶
        if (file.type.includes('word') || file.name.endsWith('.doc') || file.name.endsWith('.docx')) {
          resolve('[Wordæ–‡æ¡£: ' + file.name + ']\næ–‡ä»¶å¤§å°: ' + (file.size / 1024).toFixed(1) + ' KB\n\næ³¨ï¼šWord å†…å®¹æå–éœ€è¦åç«¯æ”¯æŒã€‚å½“å‰æ‚¨å¯ä»¥æ‰‹åŠ¨ç²˜è´´æ–‡æ¡£ä¸­çš„å…³é”®å†…å®¹ã€‚');
          return;
        }
        
        // æ–‡æœ¬æ–‡ä»¶
        const reader = new FileReader();
        reader.onload = (e) => {
          resolve(e.target.result);
        };
        reader.onerror = () => {
          resolve(`[æ–‡ä»¶è¯»å–å¤±è´¥: ${file.name}]`);
        };
        reader.readAsText(file);
        } catch (error) {
          console.error('æå–æ–‡ä»¶å†…å®¹æ—¶å‡ºé”™:', error);
          resolve('[æ–‡ä»¶å¤„ç†å¤±è´¥: ' + file.name + ' - ' + error.message + ']');
        }
      });
    }
    
    let pollingInterval;
    
    submitBtn.addEventListener('click', async () => {
      const inputText = userInput.value.trim();
      
      if (!inputText && uploadedFiles.length === 0) {
        alert('è¯·è¾“å…¥éœ€æ±‚å†…å®¹æˆ–ä¸Šä¼ æ–‡ä»¶');
        return;
      }
      
      // é‡ç½®çŠ¶æ€
      progressSection.style.display = 'block';
      resultSection.style.display = 'none';
      progressFill.style.width = '0%';
      progressPercentage.textContent = '0%';
      statusText.textContent = 'æ­£åœ¨å¤„ç†æ–‡ä»¶...';
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span>å¤„ç†ä¸­...</span>';
      resetBtn.disabled = true;
      
      try {
        // å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶
        let fileContents = '';
        if (uploadedFiles.length > 0) {
          for (const file of uploadedFiles) {
            try {
              statusText.textContent = 'æ­£åœ¨è¯†åˆ« ' + file.name + '...';
              const content = await extractFileContent(file);
              fileContents += '\n\n=== æ–‡ä»¶: ' + file.name + ' ===\n' + content;
            } catch (fileError) {
              console.error('å¤„ç†æ–‡ä»¶ ' + file.name + ' æ—¶å‡ºé”™:', fileError);
              fileContents += '\n\n=== æ–‡ä»¶: ' + file.name + ' ===\n[æ–‡ä»¶å¤„ç†å¤±è´¥: ' + fileError.message + ']';
            }
          }
        }
        
        // åˆå¹¶æ–‡æœ¬å’Œæ–‡ä»¶å†…å®¹
        let combinedText = inputText + fileContents;
        
        // ä¸¥æ ¼æ¨¡å¼ï¼šè‡ªåŠ¨æ·»åŠ å¼ºåŒ–è¦æ±‚
        const strictMode = document.getElementById('strict-mode').checked;
        if (strictMode) {
          const strictPrefix = `ã€ä¸¥æ ¼æ¨¡å¼ - å¼ºåˆ¶è¦æ±‚ã€‘\n\nä»¥ä¸‹è¦æ±‚å¿…é¡»ä¸¥æ ¼éµå®ˆï¼Œå¦åˆ™è¾“å‡ºå°†è¢«è§†ä¸ºä¸åˆæ ¼ï¼š\n\n1. æ‰€æœ‰ç›®æ ‡å¿…é¡»é‡åŒ–ï¼ˆå«å…·ä½“æ•°å­—ã€ç™¾åˆ†æ¯”ã€æ—¶é—´èŠ‚ç‚¹ï¼‰\n2. æ¯ä¸ªæ­¥éª¤å¿…é¡»æœ‰ï¼šåšä»€ä¹ˆ + æ€ä¹ˆåš + éªŒæ”¶æ ‡å‡†ï¼ˆå¯éªŒè¯ï¼‰\n3. æ‰€æœ‰èµ„æºå¿…é¡»æ˜ç¡®ï¼šäººåŠ›ï¼ˆå‡ äººï¼‰ã€é¢„ç®—ï¼ˆå¤šå°‘é’±ï¼‰ã€å·¥å…·ï¼ˆä»€ä¹ˆè½¯ä»¶/è®¾å¤‡ï¼‰ã€æ—¶é—´ï¼ˆå‡ å¤©/å‡ å°æ—¶ï¼‰\n4. æ‰€æœ‰é£é™©å¿…é¡»æœ‰ï¼šå…·ä½“é—®é¢˜ + åº”å¯¹æ–¹æ¡ˆï¼ˆä¸æ˜¯"æ³¨æ„é£é™©"ï¼‰\n5. ç¦æ­¢å‡ºç°ï¼š\n   - "æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´"\n   - "å»ºè®®è€ƒè™‘"\n   - "é€‚å½“ä¼˜åŒ–"\n   - "çµæ´»å¤„ç†"\n   - ä»»ä½•æ— æ³•é‡åŒ–éªŒè¯çš„è¡¨è¿°\n\n6. å¿…é¡»æä¾›ï¼š\n   - æ‰§è¡Œæ¸…å•ï¼ˆchecklistï¼Œå¯å‹¾é€‰ï¼‰\n   - è¯æœ¯/æ¨¡æ¿ï¼ˆç›´æ¥å¤åˆ¶å¯ç”¨ï¼‰\n   - è‡ªæŸ¥è¡¨ï¼ˆæ‰§è¡Œå‰/ä¸­/åæ£€æŸ¥ä»€ä¹ˆï¼‰\n\nã€ç”¨æˆ·åŸå§‹éœ€æ±‚ã€‘\n`;
          combinedText = strictPrefix + combinedText;
        }
        
        // åˆå§‹åŒ–æ­¥éª¤çŠ¶æ€
        initializeWorkflowSteps();
        
        // è°ƒç”¨ API åˆ›å»ºä»»åŠ¡
        statusText.textContent = 'æäº¤ä»»åŠ¡...';
        const response = await fetch('https://diyici.ai/api/cabinet/run', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ text: combinedText })
        });
        
        const data = await response.json();
        
        if (!response.ok) {
          throw new Error(data.error || 'åˆ›å»ºä»»åŠ¡å¤±è´¥');
        }
        
        const taskId = data.taskId;
        
        // å¼€å§‹è½®è¯¢çŠ¶æ€
        let retryCount = 0;
        const maxRetries = 600; // æœ€å¤šè½®è¯¢ 10 åˆ†é’Ÿï¼ˆåº”å¯¹å¤æ‚ä»»åŠ¡ï¼‰
        const startTime = Date.now();
        
        pollingInterval = setInterval(async () => {
          try {
            // æ˜¾ç¤ºå·²ç”¨æ—¶
            const elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);
            const elapsedText = elapsedSeconds < 60 
              ? `${elapsedSeconds}ç§’` 
              : `${Math.floor(elapsedSeconds / 60)}åˆ†${elapsedSeconds % 60}ç§’`;
            
            const statusResponse = await fetch(`https://diyici.ai/api/cabinet/status/${taskId}`);
            const statusData = await statusResponse.json();
            
            if (!statusResponse.ok) {
              throw new Error(statusData.error || 'æŸ¥è¯¢çŠ¶æ€å¤±è´¥');
            }
            
            // æ›´æ–°è¿›åº¦
            const progress = statusData.progress;
            progressFill.style.width = `${progress}%`;
            progressPercentage.textContent = `${progress}%`;
            
            // æ›´æ–°çŠ¶æ€æ–‡æœ¬ï¼ˆåŒ…å«å·²ç”¨æ—¶ï¼‰
            const statusMap = {
              pending: 'ç­‰å¾…ä¸­...',
              planning: 'è°‹å±€è€…æ­£åœ¨åˆ¶å®šè¡ŒåŠ¨æŒ‡å—...',
              executing: 'æ‰§è¡Œè€…æ­£åœ¨æ‰§è¡Œä»»åŠ¡...',
              reviewing: 'æ‰¾èŒ¬è€…æ­£åœ¨å®¡æ ¸æˆæœ...',
              finalizing: 'æ²‰æ·€è€…æ­£åœ¨ç”Ÿæˆæ¨¡æ¿...',
              completed: 'ä»»åŠ¡å®Œæˆ',
              failed: 'ä»»åŠ¡å¤±è´¥'
            };
            
            const baseStatus = statusMap[statusData.status] || statusData.status;
            statusText.textContent = baseStatus + 'ï¼ˆå·²ç”¨æ—¶ ' + elapsedText + 'ï¼‰';
            
            // è¶…æ—¶æé†’ï¼ˆè¶…è¿‡5åˆ†é’Ÿï¼‰
            if (elapsedSeconds > 300 && statusData.status !== 'completed' && statusData.status !== 'failed') {
              statusText.innerHTML = '';
              statusText.appendChild(document.createTextNode(baseStatus + 'ï¼ˆå·²ç”¨æ—¶ ' + elapsedText + 'ï¼‰'));
              const remindSpan = document.createElement('span');
              remindSpan.style.cssText = 'font-size: 12px; color: #f59e0b; display: block; margin-top: 4px;';
              remindSpan.textContent = 'â³ ä»»åŠ¡è¾ƒå¤æ‚ï¼Œè¯·è€å¿ƒç­‰å¾…...';
              statusText.appendChild(remindSpan);
            }
            
            // æ›´æ–°å¯è§†åŒ–æ­¥éª¤
            updateWorkflowSteps(statusData);
            
            // å®æ—¶æ˜¾ç¤ºå„è§’è‰²è¾“å‡º
            if (statusData.planningResult || statusData.executionResult || statusData.reviewResult) {
              displayRealtimeOutput(statusData);
            }
            
            // æ£€æŸ¥æ˜¯å¦å®Œæˆ
            if (statusData.status === 'completed' || statusData.status === 'failed') {
              clearInterval(pollingInterval);
              
              if (statusData.status === 'completed') {
                // è·å–ç»“æœ
                const resultResponse = await fetch(`https://diyici.ai/api/cabinet/result/${taskId}`);
                const resultData = await resultResponse.json();
                
                if (!resultResponse.ok) {
                  throw new Error(resultData.error || 'è·å–ç»“æœå¤±è´¥');
                }
                
                // æ˜¾ç¤ºç»“æœ
                displayResult(resultData);
              } else {
                // æ˜¾ç¤ºå¤±è´¥è¯¦æƒ…
                displayFailure(statusData);
              }
              
              // æ¢å¤æŒ‰é’®çŠ¶æ€
              submitBtn.disabled = false;
              submitBtn.innerHTML = '<span>å¼€å§‹æ‰§è¡Œ</span>';
              resetBtn.disabled = false;
            }
            
            retryCount++;
            if (retryCount >= maxRetries) {
              clearInterval(pollingInterval);
              statusText.textContent = 'ä»»åŠ¡æ‰§è¡Œè¶…æ—¶';
              submitBtn.disabled = false;
              submitBtn.innerHTML = '<span>å¼€å§‹æ‰§è¡Œ</span>';
              resetBtn.disabled = false;
            }
            
          } catch (error) {
            clearInterval(pollingInterval);
            statusText.textContent = `é”™è¯¯: ${error.message}`;
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<span>å¼€å§‹æ‰§è¡Œ</span>';
            resetBtn.disabled = false;
          }
        }, 1000); // æ¯ç§’è½®è¯¢ä¸€æ¬¡
        
      } catch (error) {
        console.error('æ‰§è¡Œé”™è¯¯:', error);
        statusText.textContent = `é”™è¯¯: ${error.message || 'æœªçŸ¥é”™è¯¯'}`;
        statusText.style.color = '#ef4444';
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<span>å¼€å§‹æ‰§è¡Œ</span>';
        resetBtn.disabled = false;
      }
    });
    
    resetBtn.addEventListener('click', () => {
      // æ¸…é™¤ç”¨æˆ·è¾“å…¥
      userInput.value = '';
      
      // éšè—è¿›åº¦å’Œç»“æœåŒºåŸŸ
      progressSection.style.display = 'none';
      resultSection.style.display = 'none';
      
      // æ¸…é™¤å·²ä¸Šä¼ æ–‡ä»¶
      uploadedFiles.length = 0;
      fileItems.innerHTML = '';
      fileList.style.display = 'none';
      
      // é‡ç½®ä¸¥æ ¼æ¨¡å¼
      strictModeCheckbox.checked = false;
      strictModeInfo.style.display = 'none';
      strictModeLabel.style.color = '#94a3b8';
      
      // æ¸…é™¤è½®è¯¢å®šæ—¶å™¨
      if (pollingInterval) {
        clearInterval(pollingInterval);
        pollingInterval = null;
      }
      
      // æ¢å¤æŒ‰é’®çŠ¶æ€
      submitBtn.disabled = false;
      submitBtn.innerHTML = '<span>å¼€å§‹æ‰§è¡Œ</span>';
      resetBtn.disabled = false;
      
      // é‡ç½®è¿›åº¦æ¡
      progressFill.style.width = '0%';
      progressPercentage.textContent = '0%';
      statusText.textContent = '';
      statusText.style.color = '';
      
      // æ¸…ç©ºç»“æœå®¹å™¨
      resultContainer.innerHTML = '';
      
      // é‡ç½®å·¥ä½œæµæ­¥éª¤æ˜¾ç¤º
      initializeWorkflowSteps();
      
      // æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
    
    function displayResult(result) {
      resultSection.style.display = 'block';
      resultContainer.innerHTML = '';
      
      // ğŸ¯ æ·»åŠ ä¸“ä¸šç»Ÿè®¡é¢æ¿
      addStatsPanel(result);
      
      // æ˜¾ç¤ºå„æ­¥éª¤ç»“æœ
      if (result.planning_result) {
        addResultCard('ğŸ§  è°‹å±€è€…ï¼ˆé¦–è¾…ï¼‰', 'åˆ†æéœ€æ±‚å¹¶åˆ¶å®šè¯¦ç»†çš„è¡ŒåŠ¨æŒ‡å—', result.planning_result, 'planning');
      }
      
      if (result.execution_result) {
        addResultCard('ğŸ‘¨â€ğŸ’» æ‰§è¡Œè€…ï¼ˆå¹²åï¼‰', 'æ ¹æ®è¡ŒåŠ¨æŒ‡å—æ‰§è¡Œä»»åŠ¡', result.execution_result, 'execution');
      }
      
      if (result.review_result) {
        addResultCard('ğŸ” æ‰¾èŒ¬è€…ï¼ˆå¾¡å²ï¼‰', 'å®¡æ ¸æ‰§è¡Œæˆæœå¹¶æå‡ºæ”¹è¿›æ„è§', result.review_result, 'review');
      }
      
      if (result.final_result) {
        addResultCard('ğŸ“š æ²‰æ·€è€…ï¼ˆå²å®˜ï¼‰', 'æ€»ç»“æµç¨‹å¹¶æå–å…³é”®ä¿¡æ¯', result.final_result, 'final');
      }
      
      if (result.template) {
        addResultCard('ğŸ“‹ ä¸‡èƒ½æ¨¡æ¿', 'å¯å¤ç”¨çš„æ ‡å‡†åŒ–æµç¨‹æ¨¡æ¿', result.template, 'template');
      }
      
      // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
      resultSection.scrollIntoView({ behavior: 'smooth' });
      
      // æ·»åŠ ä¸‹è½½æŒ‰é’®
      addDownloadButtons(result);
    }
    
    // ğŸ“Š æ·»åŠ ä¸“ä¸šç»Ÿè®¡é¢æ¿
    function addStatsPanel(result) {
      const statsCard = document.createElement('div');
      statsCard.className = 'result-card';
      statsCard.style.cssText = 'background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); border: 1px solid rgba(102, 126, 234, 0.3);';
      
      // è®¡ç®—ç»Ÿè®¡æ•°æ®ï¼ˆå…¼å®¹ä¸¤ç§å­—æ®µå‘½åï¼‰
      const planningChars = (result.planning_result || result.planningResult || '').length;
      const executionChars = (result.execution_result || result.executionResult || '').length;
      const reviewChars = (result.review_result || result.reviewResult || '').length;
      const finalChars = (result.final_result || result.finalResult || '').length;
      const templateChars = (result.template || '').length;
      const totalChars = planningChars + executionChars + reviewChars + finalChars + templateChars;
      
      // è®¡ç®—å‚ä¸è§’è‰²æ•°
      let roleCount = 0;
      if (planningChars > 0) roleCount++;
      if (executionChars > 0) roleCount++;
      if (reviewChars > 0) roleCount++;
      if (finalChars > 0) roleCount++;
      
      const reviewCount = result.retry_count || result.retryCount || 1;
      const qualityScore = Math.min(95, 70 + reviewCount * 5);
      
      // æ ¼å¼åŒ–æ•°å­—ï¼Œé˜²æ­¢æ¢è¡Œ
      const formatNumber = (num) => {
        return num.toLocaleString().replace(/,/g, '');
      };
      
      // åˆ›å»ºå¤´éƒ¨
      const header = document.createElement('div');
      header.className = 'result-header';
      header.innerHTML = `
        <div class="result-icon" style="background: linear-gradient(135deg, #667eea, #764ba2);">ğŸ“Š</div>
        <div class="result-title">
          <h3>æ‰§è¡Œç»Ÿè®¡æŠ¥å‘Š</h3>
          <p>å››è„‘åä½œå·¥ä½œé‡æ¦‚è§ˆ</p>
        </div>
      `;
      statsCard.appendChild(header);
      
      // åˆ›å»ºå†…å®¹åŒº
      const content = document.createElement('div');
      content.className = 'result-content';
      content.style.marginTop = '16px';
      
      // æ ¸å¿ƒæŒ‡æ ‡
      const coreMetrics = document.createElement('div');
      coreMetrics.style.cssText = 'display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 20px;';
      
      const metrics = [
        { value: roleCount, label: 'å‚ä¸è§’è‰²', color: '#667eea' },
        { value: formatNumber(totalChars), label: 'æ€»å­—æ•°', color: '#10b981' },
        { value: reviewCount, label: 'å®¡æ ¸è½®æ¬¡', color: '#f59e0b' }
      ];
      
      metrics.forEach(metric => {
        const metricDiv = document.createElement('div');
        metricDiv.style.cssText = 'text-align: center; padding: 16px 8px; background: rgba(255,255,255,0.05); border-radius: 12px; min-width: 0;';
        metricDiv.innerHTML = `
          <div style="font-size: 32px; font-weight: 700; color: ${metric.color}; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${metric.value}</div>
          <div style="font-size: 12px; color: #94a3b8; margin-top: 4px;">${metric.label}</div>
        `;
        coreMetrics.appendChild(metricDiv);
      });
      content.appendChild(coreMetrics);
      
      // è¯¦ç»†å·¥ä½œé‡
      const details = document.createElement('div');
      details.style.cssText = 'background: rgba(0,0,0,0.2); border-radius: 12px; padding: 16px; margin-bottom: 16px;';
      
      const detailsTitle = document.createElement('h4');
      detailsTitle.style.cssText = 'color: #e2e8f0; margin-bottom: 12px; font-size: 14px;';
      detailsTitle.textContent = 'ğŸ“ˆ å„è§’è‰²å·¥ä½œé‡';
      details.appendChild(detailsTitle);
      
      const workloads = [
        { chars: planningChars, icon: 'ğŸ§ ', label: 'è°‹å±€è€…åˆ†æ', color: '#667eea' },
        { chars: executionChars, icon: 'ğŸ‘¨â€ğŸ’»', label: 'æ‰§è¡Œè€…äº§å‡º', color: '#f093fb' },
        { chars: reviewChars, icon: 'ğŸ”', label: 'æ‰¾èŒ¬è€…å®¡æ ¸', color: '#4facfe' },
        { chars: finalChars, icon: 'ğŸ“š', label: 'æ²‰æ·€è€…æ€»ç»“', color: '#f5576c' },
        { chars: templateChars, icon: 'ğŸ“‹', label: 'ä¸‡èƒ½æ¨¡æ¿', color: '#10b981' }
      ];
      
      workloads.forEach((work, index) => {
        if (work.chars > 0) {
          const workDiv = document.createElement('div');
          workDiv.style.cssText = 'display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.1);';
          if (index === workloads.filter(w => w.chars > 0).length - 1) {
            workDiv.style.borderBottom = 'none';
          }
          workDiv.innerHTML = `
            <span style="color: #94a3b8;">${work.icon} ${work.label}</span>
            <span style="color: ${work.color}; font-weight: 600;">${formatNumber(work.chars)} å­—</span>
          `;
          details.appendChild(workDiv);
        }
      });
      content.appendChild(details);
      
      // è´¨é‡è¯„ä¼°
      const quality = document.createElement('div');
      quality.style.cssText = 'display: flex; align-items: center; gap: 16px; padding: 16px; background: rgba(16, 185, 129, 0.1); border-radius: 12px;';
      quality.innerHTML = `
        <div style="font-size: 24px;">âœ¨</div>
        <div style="flex: 1;">
          <div style="color: #10b981; font-weight: 600; margin-bottom: 4px;">è´¨é‡è¯„ä¼°ï¼š${qualityScore} åˆ†</div>
          <div style="color: #94a3b8; font-size: 12px;">ç»è¿‡ ${reviewCount} è½®ä¸¥æ ¼å®¡æ ¸ï¼Œæ–¹æ¡ˆå·²è¾¾åˆ°å¯æ‰§è¡Œæ ‡å‡†</div>
        </div>
        <div style="font-size: 32px; font-weight: 700; color: #10b981;">${qualityScore}</div>
      `;
      content.appendChild(quality);
      
      statsCard.appendChild(content);
      resultContainer.appendChild(statsCard);
    }
    
    // æ·»åŠ ä¸‹è½½æŒ‰é’®
    function addDownloadButtons(result) {
      const downloadCard = document.createElement('div');
      downloadCard.className = 'result-card';
      downloadCard.style.borderLeft = '4px solid #10b981';
      downloadCard.style.marginTop = '24px';
      
      // æ”¶é›†æ‰€æœ‰å¯ä¸‹è½½å†…å®¹
      let fullContent = `# æ•°å­—å†…é˜æ‰§è¡Œç»“æœ\n\n`;
      fullContent += `ç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString('zh-CN')}\n\n`;
      fullContent += `---\n\n`;
      
      if (result.planning_result) {
        fullContent += `## ä¸€ã€è°‹å±€è€…ï¼ˆé¦–è¾…ï¼‰- è¡ŒåŠ¨æŒ‡å—\n\n${result.planning_result}\n\n---\n\n`;
      }
      if (result.execution_result) {
        fullContent += `## äºŒã€æ‰§è¡Œè€…ï¼ˆå¹²åï¼‰- æ‰§è¡Œæˆæœ\n\n${result.execution_result}\n\n---\n\n`;
      }
      if (result.review_result) {
        fullContent += `## ä¸‰ã€æ‰¾èŒ¬è€…ï¼ˆå¾¡å²ï¼‰- å®¡æ ¸æ„è§\n\n${result.review_result}\n\n---\n\n`;
      }
      if (result.final_result) {
        fullContent += `## å››ã€æ²‰æ·€è€…ï¼ˆå²å®˜ï¼‰- å®Œæ•´æ€»ç»“\n\n${result.final_result}\n\n---\n\n`;
      }
      if (result.template) {
        fullContent += `## äº”ã€ä¸‡èƒ½æ¨¡æ¿\n\n${result.template}\n\n`;
      }
      
      // åˆ›å»ºå¤´éƒ¨
      const header = document.createElement('div');
      header.className = 'result-header';
      header.innerHTML = `
        <div class="result-icon" style="background: linear-gradient(135deg, #10b981, #059669);">ğŸ’¾</div>
        <div class="result-title">
          <h3>ä¸‹è½½æˆæœ</h3>
          <p>ä¿å­˜æ‰§è¡Œç»“æœåˆ°æœ¬åœ°</p>
        </div>
      `;
      downloadCard.appendChild(header);
      
      // åˆ›å»ºå†…å®¹åŒº
      const content = document.createElement('div');
      content.className = 'result-content';
      content.style.marginTop = '16px';
      
      // åˆ›å»ºæŒ‰é’®å®¹å™¨
      const btnContainer = document.createElement('div');
      btnContainer.style.cssText = 'display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px;';
      
      // ä¸‹è½½æŒ‰é’®é…ç½®
      const downloadBtns = [
        { text: 'ğŸ“„ ä¸‹è½½ Markdown', color: 'linear-gradient(135deg, #667eea, #764ba2)', action: window.downloadMarkdown },
        { text: 'ğŸ“ ä¸‹è½½ Word', color: 'linear-gradient(135deg, #f093fb, #f5576c)', action: window.downloadWord },
        { text: 'ğŸ“ƒ ä¸‹è½½çº¯æ–‡æœ¬', color: 'linear-gradient(135deg, #4facfe, #00f2fe)', action: window.downloadText }
      ];
      
      downloadBtns.forEach(btnConfig => {
        const btn = document.createElement('button');
        btn.className = 'download-btn';
        btn.style.cssText = 'padding: 12px 20px; background: ' + btnConfig.color + '; border: none; border-radius: 8px; color: #fff; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.3s ease;';
        btn.textContent = btnConfig.text;
        btn.onclick = btnConfig.action;
        btnContainer.appendChild(btn);
      });
      
      content.appendChild(btnContainer);
      downloadCard.appendChild(content);
      resultContainer.appendChild(downloadCard);
      
      // å­˜å‚¨å†…å®¹ä¾›ä¸‹è½½ä½¿ç”¨
      window._downloadContent = fullContent;
    }
    
    // ä¸‹è½½ Markdown
    window.downloadMarkdown = function() {
      const blob = new Blob([window._downloadContent], { type: 'text/markdown;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `æ•°å­—å†…é˜æˆæœ_${new Date().toISOString().slice(0, 10)}.md`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    };
    
    // ä¸‹è½½ Wordï¼ˆä½¿ç”¨ HTML æ ¼å¼ï¼‰
    window.downloadWord = function() {
      try {
        // å®‰å…¨åœ°å¤„ç†å†…å®¹
        let processedContent = (window._downloadContent || '')
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;');
        
        // è½¬æ¢æ¢è¡Œ
        processedContent = processedContent.replace(/\n/g, '<br>');
        
        // è½¬æ¢æ ‡é¢˜
        processedContent = processedContent.replace(/#{1,6} (.*?)<br>/g, function(match, p1) {
          return '<h2>' + p1 + '</h2>';
        });
        
        const htmlContent = '<!DOCTYPE html>' +
          '<html>' +
          '<head>' +
          '<meta charset="UTF-8">' +
          '<title>æ•°å­—å†…é˜æ‰§è¡Œç»“æœ</title>' +
          '<style>' +
          'body { font-family: \'Microsoft YaHei\', Arial, sans-serif; line-height: 1.8; padding: 40px; max-width: 800px; margin: 0 auto; }' +
          'h1 { color: #667eea; border-bottom: 2px solid #667eea; padding-bottom: 10px; }' +
          'h2 { color: #764ba2; margin-top: 30px; }' +
          'pre { background: #f5f5f5; padding: 15px; border-radius: 5px; white-space: pre-wrap; }' +
          '</style>' +
          '</head>' +
          '<body>' + processedContent + '</body>' +
          '</html>';
          
        const blob = new Blob([htmlContent], { type: 'application/msword;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'æ•°å­—å†…é˜æˆæœ_' + new Date().toISOString().slice(0, 10) + '.doc';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      } catch (error) {
        console.error('ä¸‹è½½Wordå¤±è´¥:', error);
        alert('ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•');
      }
    };
    
    // ä¸‹è½½çº¯æ–‡æœ¬
    window.downloadText = function() {
      try {
        const textContent = (window._downloadContent || '')
          .replace(/#{1,6} /g, '')
          .replace(/^---$/gm, '-------------------')
          .replace(/\*\*/g, '');
          
        const blob = new Blob([textContent], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'æ•°å­—å†…é˜æˆæœ_' + new Date().toISOString().slice(0, 10) + '.txt';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      } catch (error) {
        console.error('ä¸‹è½½æ–‡æœ¬å¤±è´¥:', error);
        alert('ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•');
      }
    };
    
    // å¤åˆ¶å†…å®¹åˆ°å‰ªè´´æ¿
    window.copyToClipboard = async function(button, text) {
      try {
        // ç›´æ¥æ¥æ”¶æ–‡æœ¬ï¼Œä¸éœ€è¦è§£ç 
        await navigator.clipboard.writeText(text || '');
        
        // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸ
        const originalText = button.innerHTML;
        button.innerHTML = 'âœ… å·²å¤åˆ¶';
        button.style.background = 'rgba(16, 185, 129, 0.2)';
        button.style.borderColor = '#10b981';
        button.style.color = '#10b981';
        
        setTimeout(() => {
          button.innerHTML = originalText;
          button.style.background = 'rgba(255,255,255,0.1)';
          button.style.borderColor = 'rgba(255,255,255,0.2)';
          button.style.color = '#94a3b8';
        }, 2000);
      } catch (err) {
        console.error('å¤åˆ¶å¤±è´¥:', err);
        alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
      }
    };
        alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
      }
    };
    
    // å°† Markdown æ¸²æŸ“ä¸ºç¾è§‚çš„ HTML
    function renderMarkdown(text) {
      if (!text) return '';
      
      try {
        let html = '';
        const lines = text.split('\n');
        let inList = false;
        let listItems = [];
        
        const flushList = () => {
          if (listItems.length > 0) {
            html += '<div style="margin: 12px 0;">' + listItems.join('') + '</div>';
            listItems = [];
            inList = false;
          }
        };
        
        const escapeHtml = (str) => {
          return str
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');
        };
        
        const processInline = (str) => {
          // å…ˆè½¬ä¹‰ HTML
          let result = escapeHtml(str);
          // ç²—ä½“
          result = result.replace(/\*\*(.+?)\*\*/g, '<strong style="color: #fbbf24; font-weight: 600;">$1</strong>');
          // æ–œä½“ï¼ˆä¸åŒ¹é… ** ä¸­çš„ *ï¼‰
          result = result.replace(/(?<!\*)\*(?!\*)(.+?)\*(?!\*)/g, '<em style="color: #a78bfa;">$1</em>');
          return result;
        };
        
        for (let i = 0; i < lines.length; i++) {
          const line = lines[i];
          const trimmed = line.trim();
          
          // ç©ºè¡Œ
          if (!trimmed) {
            flushList();
            html += '<br>';
            continue;
          }
          
          // åˆ†å‰²çº¿
          if (trimmed === '---' || trimmed === '***' || trimmed === '___') {
            flushList();
            html += '<hr style="border: none; border-top: 1px solid rgba(255,255,255,0.1); margin: 20px 0;">';
            continue;
          }
          
          // æ ‡é¢˜
          if (trimmed.startsWith('# ')) {
            flushList();
            const content = processInline(trimmed.slice(2));
            html += '<h1 style="color: #667eea; font-size: 22px; margin: 28px 0 16px; font-weight: 700; border-bottom: 2px solid #667eea; padding-bottom: 8px;">' + content + '</h1>';
            continue;
          }
          if (trimmed.startsWith('## ')) {
            flushList();
            const content = processInline(trimmed.slice(3));
            html += '<h2 style="color: #f093fb; font-size: 19px; margin: 24px 0 14px; font-weight: 600;">' + content + '</h2>';
            continue;
          }
          if (trimmed.startsWith('### ')) {
            flushList();
            const content = processInline(trimmed.slice(4));
            html += '<h3 style="color: #667eea; font-size: 17px; margin: 20px 0 12px; font-weight: 600; border-bottom: 1px solid rgba(102,126,234,0.3); padding-bottom: 8px;">' + content + '</h3>';
            continue;
          }
          if (trimmed.startsWith('#### ')) {
            flushList();
            const content = processInline(trimmed.slice(5));
            html += '<h4 style="color: #e2e8f0; font-size: 15px; margin: 18px 0 10px; font-weight: 600;">' + content + '</h4>';
            continue;
          }
          if (trimmed.startsWith('##### ')) {
            flushList();
            const content = processInline(trimmed.slice(6));
            html += '<h5 style="color: #94a3b8; font-size: 14px; margin: 16px 0 8px; font-weight: 600;">' + content + '</h5>';
            continue;
          }
          
          // æ— åºåˆ—è¡¨
          if (trimmed.match(/^[-\*]\s/)) {
            const content = processInline(trimmed.slice(2));
            listItems.push('<div style="margin: 4px 0; padding-left: 16px; position: relative;"><span style="position: absolute; left: 0; color: #667eea; font-weight: bold;">â€¢</span>' + content + '</div>');
            inList = true;
            continue;
          }
          
          // æœ‰åºåˆ—è¡¨
          const orderedMatch = trimmed.match(/^(\d+)\.\s(.+)$/);
          if (orderedMatch) {
            const content = processInline(orderedMatch[2]);
            listItems.push('<div style="margin: 4px 0; padding-left: 24px; position: relative;"><span style="position: absolute; left: 0; color: #10b981; font-weight: 600;">' + orderedMatch[1] + '.</span>' + content + '</div>');
            inList = true;
            continue;
          }
          
          // æ™®é€šæ®µè½
          flushList();
          const content = processInline(trimmed);
          html += '<p style="margin: 8px 0; line-height: 1.8;">' + content + '</p>';
        }
        
        flushList();
        
        // æ¸…ç†å¤šä½™çš„ <br>
        html = html.replace(/<br><br><br>/g, '<br><br>');
        html = html.replace(/<p style="margin: 8px 0; line-height: 1.8;"><\/p>/g, '');
        
        return html;
      } catch (error) {
        console.error('renderMarkdown é”™è¯¯:', error);
        // å¤±è´¥æ—¶è¿”å›ç®€å•è½¬ä¹‰æ–‡æœ¬
        return text
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;')
          .replace(/\n/g, '<br>');
      }
    }
    
    // æ˜¾ç¤ºå¤±è´¥è¯¦æƒ…
    function displayFailure(statusData) {
      resultSection.style.display = 'block';
      resultContainer.innerHTML = '';
      
      // å¤±è´¥æ ‡é¢˜
      const failHeader = document.createElement('div');
      failHeader.className = 'result-card';
      failHeader.style.borderLeft = '4px solid #ef4444';
      
      const failStep = getStepName(statusData.failStep) || 'å®¡æŸ¥ç¯èŠ‚';
      const failReason = statusData.failReason || 'å®¡æ ¸æœªé€šè¿‡ï¼Œå·²è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°';
      const retryCount = statusData.retryCount || 0;
      
      failHeader.innerHTML = `
        <div class="result-header">
          <div class="result-icon" style="background: linear-gradient(135deg, #ef4444, #dc2626);">âŒ</div>
          <div class="result-title">
            <h3>ä»»åŠ¡æ‰§è¡Œå¤±è´¥</h3>
            <p>å››è„‘åä½œæœªèƒ½å®Œæˆä»»åŠ¡</p>
          </div>
        </div>
      `;
      
      // åˆ›å»ºå†…å®¹åŒº
      const contentDiv = document.createElement('div');
      contentDiv.className = 'result-content';
      contentDiv.style.marginTop = '16px';
      
      // å¤±è´¥ç¯èŠ‚
      const failStepDiv = document.createElement('div');
      failStepDiv.style.cssText = 'background: rgba(239, 68, 68, 0.1); border-radius: 12px; padding: 16px; margin-bottom: 16px;';
      failStepDiv.innerHTML = '<h4 style="color: #ef4444; margin-bottom: 8px;">ğŸ“ å¤±è´¥ç¯èŠ‚</h4>';
      const failStepP = document.createElement('p');
      failStepP.style.color = '#e2e8f0';
      failStepP.textContent = failStep;
      failStepDiv.appendChild(failStepP);
      contentDiv.appendChild(failStepDiv);
      
      // å¤±è´¥åŸå› 
      const failReasonDiv = document.createElement('div');
      failReasonDiv.style.cssText = 'background: rgba(239, 68, 68, 0.05); border-radius: 12px; padding: 16px; margin-bottom: 16px;';
      failReasonDiv.innerHTML = '<h4 style="color: #f87171; margin-bottom: 8px;">â— å¤±è´¥åŸå› </h4>';
      const failReasonP = document.createElement('p');
      failReasonP.style.cssText = 'color: #e2e8f0; line-height: 1.6;';
      failReasonP.textContent = failReason;
      failReasonDiv.appendChild(failReasonP);
      contentDiv.appendChild(failReasonDiv);
      
      // é‡è¯•æ¬¡æ•°
      if (retryCount > 0) {
        const retryDiv = document.createElement('div');
        retryDiv.style.cssText = 'background: rgba(99, 102, 241, 0.1); border-radius: 12px; padding: 16px; margin-bottom: 16px;';
        retryDiv.innerHTML = '<h4 style="color: #818cf8; margin-bottom: 8px;">ğŸ”„ é‡è¯•æ¬¡æ•°</h4>';
        const retryP = document.createElement('p');
        retryP.style.color = '#e2e8f0';
        retryP.textContent = 'å…±å°è¯• ' + retryCount + ' æ¬¡';
        retryDiv.appendChild(retryP);
        contentDiv.appendChild(retryDiv);
      }
      
      failHeader.appendChild(contentDiv);
      resultContainer.appendChild(failHeader);
      
      // æ˜¾ç¤ºå·²æœ‰çš„æˆæœ
      if (statusData.planningResult) {
        addResultCard('è°‹å±€è€…ï¼ˆé¦–è¾…ï¼‰', 'åˆ†æéœ€æ±‚å¹¶åˆ¶å®šè¡ŒåŠ¨æŒ‡å—', statusData.planningResult);
      }
      
      if (statusData.executionResult) {
        addResultCard('æ‰§è¡Œè€…ï¼ˆå¹²åï¼‰', 'æ ¹æ®è¡ŒåŠ¨æŒ‡å—æ‰§è¡Œä»»åŠ¡', statusData.executionResult);
      }
      
      if (statusData.reviewResult) {
        addResultCard('æ‰¾èŒ¬è€…ï¼ˆå¾¡å²ï¼‰', 'å®¡æ ¸æ‰§è¡Œæˆæœ', statusData.reviewResult);
      }
      
      // æ·»åŠ å»ºè®®
      const suggestionCard = document.createElement('div');
      suggestionCard.className = 'result-card';
      suggestionCard.style.borderLeft = '4px solid #10b981';
      suggestionCard.innerHTML = `
        <div class="result-header">
          <div class="result-icon" style="background: linear-gradient(135deg, #10b981, #059669);">ğŸ’¡</div>
          <div class="result-title">
            <h3>æ”¹è¿›å»ºè®®</h3>
            <p>å¦‚ä½•è®©ä»»åŠ¡æ›´å®¹æ˜“é€šè¿‡</p>
          </div>
        </div>
      `;
      
      const suggestionContent = document.createElement('div');
      suggestionContent.className = 'result-content';
      suggestionContent.style.marginTop = '16px';
      
      const suggestionList = document.createElement('ul');
      suggestionList.style.cssText = 'color: #e2e8f0; line-height: 1.8; padding-left: 20px;';
      
      const suggestions = [
        'éœ€æ±‚æè¿°æ›´å…·ä½“ï¼ŒåŒ…å«èƒŒæ™¯ã€ç›®æ ‡ã€çº¦æŸæ¡ä»¶',
        'æä¾›å…·ä½“çš„ä¾‹å­æˆ–å‚è€ƒæ ‡å‡†',
        'è¯´æ˜æœŸæœ›çš„è¾“å‡ºæ ¼å¼å’Œè¯¦ç»†ç¨‹åº¦',
        'å¦‚æœæ¶‰åŠä¸“ä¸šçŸ¥è¯†ï¼Œæä¾›ç›¸å…³æœ¯è¯­è§£é‡Š'
      ];
      
      suggestions.forEach(text => {
        const li = document.createElement('li');
        li.textContent = text;
        suggestionList.appendChild(li);
      });
      
      suggestionContent.appendChild(suggestionList);
      suggestionCard.appendChild(suggestionContent);
      resultContainer.appendChild(suggestionCard);
      
      // å¦‚æœæœ‰éƒ¨åˆ†æˆæœï¼Œæ·»åŠ ä¸‹è½½æŒ‰é’®
      if (statusData.planningResult || statusData.executionResult || statusData.reviewResult) {
        const partialResult = {
          planning_result: statusData.planningResult,
          execution_result: statusData.executionResult,
          review_result: statusData.reviewResult
        };
        addDownloadButtons(partialResult);
      }
      
      // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
      resultSection.scrollIntoView({ behavior: 'smooth' });
      
      // æ¢å¤æŒ‰é’®çŠ¶æ€
      submitBtn.disabled = false;
      submitBtn.innerHTML = '<span>é‡æ–°æ‰§è¡Œ</span>';
      resetBtn.disabled = false;
    }
    
    // è·å–ç¯èŠ‚åç§°
    function getStepName(step) {
      const stepNames = {
        'planning': 'è°‹å±€é˜¶æ®µï¼ˆé¦–è¾…ï¼‰',
        'executing': 'æ‰§è¡Œé˜¶æ®µï¼ˆå¹²åï¼‰',
        'reviewing': 'å®¡æŸ¥é˜¶æ®µï¼ˆå¾¡å²ï¼‰',
        'finalizing': 'æ²‰æ·€é˜¶æ®µï¼ˆå²å®˜ï¼‰'
      };
      return stepNames[step] || step;
    }
    
    // åˆå§‹åŒ–å·¥ä½œæµæ­¥éª¤
    function initializeWorkflowSteps() {
      const steps = ['planning', 'execution', 'review', 'archive'];
      
      steps.forEach(step => {
        const stepEl = document.getElementById(`step-${step}`);
        if (!stepEl) return;
        
        const statusEl = stepEl.querySelector('.step-status');
        const thinkingEl = document.getElementById(`${step}-thinking`);
        const outputEl = document.getElementById(`${step}-output`);
        
        stepEl.classList.remove('active', 'completed', 'failed');
        statusEl.textContent = 'â¸ï¸ ç­‰å¾…ä¸­';
        
        if (thinkingEl) {
          thinkingEl.textContent = step === 'planning' ? 'æ­£åœ¨åˆ†ææ‚¨çš„éœ€æ±‚...' : 
                                   step === 'execution' ? 'ç­‰å¾…å¯åŠ¨...' :
                                   step === 'review' ? 'ç­‰å¾…å®¡æ ¸...' : 'ç­‰å¾…æ€»ç»“...';
        }
        if (outputEl) {
          outputEl.textContent = 'ç­‰å¾…ç”Ÿæˆ...';
        }
      });
    }
    
    // æ›´æ–°å·¥ä½œæµæ­¥éª¤æ˜¾ç¤º
    function updateWorkflowSteps(statusData) {
      const steps = ['planning', 'execution', 'review', 'archive'];
      const currentStatus = statusData.status;
      
      steps.forEach((step, index) => {
        const stepEl = document.getElementById(`step-${step}`);
        if (!stepEl) return;
        
        const statusEl = stepEl.querySelector('.step-status');
        const thinkingEl = document.getElementById(`${step}-thinking`);
        const outputEl = document.getElementById(`${step}-output`);
        
        // æ ¹æ®å½“å‰çŠ¶æ€æ›´æ–°æ­¥éª¤
        if (currentStatus === step) {
          // å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ­¥éª¤
          stepEl.classList.add('active');
          stepEl.classList.remove('completed', 'failed');
          statusEl.textContent = 'â³ è¿›è¡Œä¸­';
          
          // å¦‚æœæœ‰ä¸­é—´ç»“æœï¼Œæ˜¾ç¤ºå‡ºæ¥
          if (statusData[`${step}_thinking`] && thinkingEl) {
            thinkingEl.textContent = statusData[`${step}_thinking`];
          }
          if (statusData[`${step}_output`] && outputEl) {
            outputEl.textContent = statusData[`${step}_output`];
          }
        } else if (steps.indexOf(currentStatus) > index) {
          // å·²å®Œæˆçš„æ­¥éª¤
          stepEl.classList.remove('active');
          stepEl.classList.add('completed');
          statusEl.textContent = 'âœ… å·²å®Œæˆ';
          
          // æ˜¾ç¤ºæœ€ç»ˆç»“æœ
          if (statusData[`${step}_thinking`] && thinkingEl) {
            thinkingEl.textContent = statusData[`${step}_thinking`];
          }
          if (statusData[`${step}_output`] && outputEl) {
            outputEl.textContent = statusData[`${step}_output`];
          }
        } else {
          // ç­‰å¾…ä¸­çš„æ­¥éª¤
          stepEl.classList.remove('active', 'completed', 'failed');
          statusEl.textContent = 'â¸ï¸ ç­‰å¾…ä¸­';
        }
      });
      
      // å¦‚æœå¤±è´¥ï¼Œæ ‡è®°å½“å‰æ­¥éª¤ä¸ºå¤±è´¥
      if (currentStatus === 'failed') {
        const activeStep = document.querySelector('.workflow-step.active');
        if (activeStep) {
          activeStep.classList.remove('active');
          activeStep.classList.add('failed');
          activeStep.querySelector('.step-status').textContent = 'âŒ å¤±è´¥';
        }
      }
    }
    
    function addResultCard(title, subtitle, content, type = '') {
      const card = document.createElement('div');
      card.className = 'result-card';
      
      // æ ¹æ®ç±»å‹è®¾ç½®è¾¹æ¡†é¢œè‰²
      const colors = {
        'planning': '#667eea',
        'execution': '#f093fb',
        'review': '#4facfe',
        'final': '#f5576c',
        'template': '#10b981'
      };
      const borderColor = colors[type] || '#667eea';
      card.style.borderLeft = `4px solid ${borderColor}`;
      
      // è®¡ç®—å­—æ•°
      const charCount = content?.length || 0;
      const wordCount = charCount > 1000 ? (charCount/1000).toFixed(1) + 'k' : charCount;
      
      // ä¼°ç®—é˜…è¯»æ—¶é—´ï¼ˆæŒ‰ 300å­—/åˆ†é’Ÿï¼‰
      const readTime = Math.max(1, Math.ceil(charCount / 300));
      
      card.innerHTML = `
        <div class="result-header">
          <div class="result-icon" style="background: linear-gradient(135deg, ${borderColor}, ${borderColor}aa);">${title.charAt(0)}</div>
          <div class="result-title" style="flex: 1;">
            <h3 style="margin-bottom: 4px;">${title}</h3>
            <p style="color: #94a3b8; font-size: 13px;">${subtitle}</p>
          </div>
          <div style="text-align: right;">
            <div style="font-size: 18px; font-weight: 700; color: ${borderColor};">${wordCount}</div>            <div style="font-size: 11px; color: #64748b;">å­— Â· ${readTime}åˆ†é’Ÿé˜…è¯»</div>
          </div>        </div>
        <div class="result-content" style="margin-top: 16px; line-height: 1.8; color: #e2e8f0;">${renderMarkdown(content)}</div>
        <div style="margin-top: 12px; text-align: right;" class="copy-btn-container"></div>
      `;
      
      // åˆ›å»ºå¤åˆ¶æŒ‰é’®ï¼ˆä½¿ç”¨DOM APIé¿å…HTMLå±æ€§æ³¨å…¥é—®é¢˜ï¼‰
      const copyBtnContainer = card.querySelector('.copy-btn-container');
      const copyBtn = document.createElement('button');
      copyBtn.style.cssText = 'padding: 6px 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: #94a3b8; font-size: 12px; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; gap: 4px;';
      copyBtn.innerHTML = 'ğŸ“‹ å¤åˆ¶å†…å®¹';
      copyBtn.onclick = function() {
        copyToClipboard(this, content || '');
      };
      copyBtnContainer.appendChild(copyBtn);
      
      resultContainer.appendChild(card);
    }
    
    // å®æ—¶æ˜¾ç¤ºå„è§’è‰²è¾“å‡º
    function displayRealtimeOutput(statusData) {
      // ç¡®ä¿ç»“æœåŒºåŸŸå¯è§
      if (resultSection.style.display === 'none') {
        resultSection.style.display = 'block';
      }
      
      // æ¸…ç©ºä¹‹å‰çš„å†…å®¹é‡æ–°æ¸²æŸ“ï¼ˆä¿æŒæœ€æ–°ï¼‰
      resultContainer.innerHTML = '';
      
      // åˆ›å»ºå¡ç‰‡è¾…åŠ©å‡½æ•°
      function createRoleCard(title, icon, color, content, status, statusText) {
        const card = document.createElement('div');
        card.className = 'result-card';
        card.style.borderLeft = '4px solid ' + color;
        card.innerHTML = `
          <div class="result-header">
            <div class="result-icon" style="background: linear-gradient(135deg, ${color}, ${color}aa);">${icon}</div>
            <div class="result-title">
              <h3>${title}</h3>
              <p>${statusText}</p>
            </div>
          </div>
          <div class="result-content" style="margin-top: 12px; max-height: 300px; overflow-y: auto;">
            ${renderMarkdown(content)}
          </div>
          <div style="margin-top: 12px; text-align: right;" class="copy-btn-container"></div>
        `;
        
        // åˆ›å»ºå¤åˆ¶æŒ‰é’®
        const copyBtnContainer = card.querySelector('.copy-btn-container');
        const copyBtn = document.createElement('button');
        copyBtn.style.cssText = 'padding: 6px 12px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: #94a3b8; font-size: 12px; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; gap: 4px;';
        copyBtn.innerHTML = 'ğŸ“‹ å¤åˆ¶å†…å®¹';
        copyBtn.onclick = function() {
          copyToClipboard(this, content || '');
        };
        copyBtnContainer.appendChild(copyBtn);
        
        return card;
      }
      
      // æ˜¾ç¤ºè°‹å±€è€…è¾“å‡º
      if (statusData.planningResult) {
        const planningCard = createRoleCard(
          'è°‹å±€è€…ï¼ˆé¦–è¾…ï¼‰',
          'è°‹',
          '#667eea',
          statusData.planningResult,
          statusData.status,
          statusData.status === 'planning' ? 'æ­£åœ¨åˆ†æ...' : 'åˆ†æå®Œæˆ'
        );
        resultContainer.appendChild(planningCard);
      }
      
      // æ˜¾ç¤ºæ‰§è¡Œè€…è¾“å‡º
      if (statusData.executionResult) {
        const executionCard = createRoleCard(
          'æ‰§è¡Œè€…ï¼ˆå¹²åï¼‰',
          'æ‰§',
          '#f093fb',
          statusData.executionResult,
          statusData.status,
          statusData.status === 'executing' ? 'æ­£åœ¨å¹²æ´»...' : 'æ‰§è¡Œå®Œæˆ'
        );
        resultContainer.appendChild(executionCard);
      }
      
      // æ˜¾ç¤ºå®¡æŸ¥å‘˜è¾“å‡º
      if (statusData.reviewResult) {
        const reviewCard = createRoleCard(
          'æ‰¾èŒ¬è€…ï¼ˆå¾¡å²ï¼‰',
          'æŸ¥',
          '#4facfe',
          statusData.reviewResult,
          statusData.status,
          statusData.status === 'reviewing' ? 'æ­£åœ¨å®¡æ ¸...' : 'å®¡æ ¸å®Œæˆ'
        );
        
        // æ·»åŠ é‡è¯•æ¬¡æ•°æ˜¾ç¤º
        if (statusData.retryCount) {
          const retryDiv = document.createElement('div');
          retryDiv.style.cssText = 'margin-top: 12px; padding: 8px 12px; background: rgba(99, 102, 241, 0.1); border-radius: 8px; font-size: 12px; color: #818cf8;';
          retryDiv.textContent = 'ç¬¬ ' + statusData.retryCount + ' è½®å®¡æŸ¥';
          reviewCard.appendChild(retryDiv);
        }
        
        resultContainer.appendChild(reviewCard);
      }
      
      // æ»šåŠ¨åˆ°æœ€æ–°å†…å®¹
      resultContainer.scrollTop = resultContainer.scrollHeight;
    }
  </script>
</body>
</html>
  <script>
    // å…¨å±€é”™è¯¯å¤„ç†
    window.onerror = function(msg, url, line) {
      console.error("JSé”™è¯¯:", msg, "è¡Œ:", line);
      alert("é¡µé¢é”™è¯¯: " + msg + " (è¡Œ: " + line + ")");
    };
    // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥DOMå…ƒç´ 
    document.addEventListener('DOMContentLoaded', () => {
      console.log('=== æ•°å­—å†…é˜é¡µé¢åŠ è½½å®Œæˆ ===');
      console.log('ä¸¥æ ¼æ¨¡å¼å¤é€‰æ¡†:', document.getElementById('strict-mode') ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨');
      console.log('ä¸¥æ ¼æ¨¡å¼è¯´æ˜æ¡†:', document.getElementById('strict-mode-info') ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨');
      console.log('ä¸¥æ ¼æ¨¡å¼æ ‡ç­¾:', document.getElementById('strict-mode-label') ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨');
      console.log('æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ:', document.getElementById('file-upload-area') ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨');
      console.log('æ–‡ä»¶è¾“å…¥:', document.getElementById('file-input') ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨');
      console.log('é‡ç½®æŒ‰é’®:', document.getElementById('reset-btn') ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨');
      console.log('========================');
    });
  </script>

<script>
    // å…¨å±€é”™è¯¯å¤„ç†
    window.onerror = function(msg, url, line) {
      console.error("JSé”™è¯¯:", msg, "è¡Œ:", line);
      alert("é¡µé¢é”™è¯¯: " + msg + " (è¡Œ: " + line + ")");
    };
// å¤‡ç”¨å®ç° - ç®€åŒ–ç‰ˆç¡®ä¿åŸºæœ¬åŠŸèƒ½
(function() {
  console.log('å¤‡ç”¨å®ç°åŠ è½½ä¸­...');
  
  // ä¸¥æ ¼æ¨¡å¼
  const strictCheckbox = document.getElementById('strict-mode');
  const strictInfo = document.getElementById('strict-mode-info');
  const strictLabel = document.getElementById('strict-mode-label');
  
  if (strictCheckbox && strictInfo) {
    strictCheckbox.addEventListener('change', function() {
      strictInfo.style.display = this.checked ? 'block' : 'none';
      if (strictLabel) strictLabel.style.color = this.checked ? '#fbbf24' : '#94a3b8';
    });
  }
  
  // é‡ç½®åŠŸèƒ½
  const resetButton = document.getElementById('reset-btn');
  const userInputField = document.getElementById('user-input');
  const fileListEl = document.getElementById('file-list');
  const fileItemsEl = document.getElementById('file-items');
  
  if (resetButton) {
    resetButton.addEventListener('click', function() {
      if (userInputField) userInputField.value = '';
      if (strictCheckbox) strictCheckbox.checked = false;
      if (strictInfo) strictInfo.style.display = 'none';
      if (strictLabel) strictLabel.style.color = '#94a3b8';
      if (fileItemsEl) fileItemsEl.innerHTML = '';
      if (fileListEl) fileListEl.style.display = 'none';
      // æ¸…ç©ºæ–‡ä»¶æ•°ç»„
      if (window.uploadedFiles) window.uploadedFiles.length = 0;
    });
  }
  
  // æ–‡ä»¶ä¸Šä¼  - å¤šæ–‡ä»¶æ”¯æŒ
  const fileUploadAreaEl = document.getElementById('file-upload-area');
  const fileInputEl = document.getElementById('file-input');
  
  if (fileUploadAreaEl && fileInputEl && fileItemsEl && fileListEl) {
    // ç¡®ä¿ä¸Šä¼ æ–‡ä»¶æ•°ç»„å­˜åœ¨
    if (!window.uploadedFiles) window.uploadedFiles = [];
    
    fileUploadAreaEl.addEventListener('click', function() {
      fileInputEl.click();
    });
    
    // æ¸²æŸ“æ–‡ä»¶åˆ—è¡¨
    function renderFiles() {
      if (window.uploadedFiles.length === 0) {
        fileItemsEl.innerHTML = '';
        fileListEl.style.display = 'none';
        return;
      }
      
      fileItemsEl.innerHTML = '';
      window.uploadedFiles.forEach(function(file, index) {
        const fileDiv = document.createElement('div');
        fileDiv.style.cssText = 'display: flex; align-items: center; justify-content: space-between; padding: 8px 12px; background: rgba(102,126,234,0.1); border-radius: 8px; margin-bottom: 8px; font-size: 13px;';
        
        const fileInfo = document.createElement('span');
        fileInfo.innerHTML = 'ğŸ“ ' + file.name + ' <span style="color: #64748b;">(' + (file.size/1024).toFixed(1) + ' KB)</span>';
        
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'Ã—';
        deleteBtn.style.cssText = 'background: none; border: none; color: #ef4444; font-size: 18px; cursor: pointer; padding: 0 4px;';
        deleteBtn.onclick = function() {
          window.uploadedFiles.splice(index, 1);
          renderFiles();
        };
        
        fileDiv.appendChild(fileInfo);
        fileDiv.appendChild(deleteBtn);
        fileItemsEl.appendChild(fileDiv);
      });
      
      fileListEl.style.display = 'block';
    }
    
    fileInputEl.addEventListener('change', function(e) {
      const files = Array.from(e.target.files);
      files.forEach(function(file) {
        // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
        const exists = window.uploadedFiles.some(function(f) {
          return f.name === file.name && f.size === file.size;
        });
        if (!exists) {
          window.uploadedFiles.push(file);
        }
      });
      renderFiles();
      // é‡ç½®inputä»¥ä¾¿å†æ¬¡é€‰æ‹©
      e.target.value = '';
    });
  }
  
  console.log('å¤‡ç”¨å®ç°åŠ è½½å®Œæˆ');
})();
</script>
</body></html>

<script>
// å…¨å±€é”™è¯¯å¤„ç†
window.onerror = function(msg, url, line) {
  console.error("JSé”™è¯¯:", msg, "è¡Œ:", line);
};

// æ£€æŸ¥submitæŒ‰é’®
(function() {
  console.log('=== æ£€æŸ¥submitæŒ‰é’® ===');
  const submitBtn = document.getElementById('submit-btn');
  console.log('submitBtn:', submitBtn ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨');
  if (submitBtn) {
    console.log('submitBtn.disabled:', submitBtn.disabled);
    console.log('submitBtn.innerHTML:', submitBtn.innerHTML.substring(0, 50));
    
    // æ·»åŠ æµ‹è¯•ç‚¹å‡»
    submitBtn.addEventListener('click', function(e) {
      console.log('âœ… submitæŒ‰é’®è¢«ç‚¹å‡»ï¼');
    });
  }
  console.log('========================');
})();
</script>

</body>
</html>
