<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ•°å­—å†…é˜ - ä½ çš„ä¸“å±å››äººAIå›¢é˜Ÿ</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(180deg, #0f0f23 0%, #1a1a3e 100%);
      min-height: 100vh;
      color: #e2e8f0;
      line-height: 1.6;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    .header {
      text-align: center;
      padding: 40px 0;
    }
    .brand-name {
      font-size: 48px;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea 0%, #f093fb 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 16px;
    }
    .page-title {
      font-size: 24px;
      color: #fff;
      margin-bottom: 12px;
    }
    .page-subtitle {
      color: #94a3b8;
      font-size: 16px;
    }
    .input-section {
      background: rgba(255,255,255,0.05);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .input-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    label {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      font-size: 14px;
      color: #94a3b8;
    }
    textarea {
      width: 100%;
      min-height: 150px;
      padding: 16px;
      background: rgba(0,0,0,0.2);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      color: #fff;
      font-size: 15px;
      resize: vertical;
      margin-bottom: 16px;
    }
    textarea:focus {
      outline: none;
      border-color: #667eea;
    }
    .file-upload-area {
      border: 2px dashed rgba(102,126,234,0.5);
      border-radius: 12px;
      padding: 24px;
      text-align: center;
      background: rgba(102,126,234,0.05);
      cursor: pointer;
      margin-bottom: 16px;
    }
    .button-group {
      display: flex;
      gap: 12px;
    }
    button {
      flex: 1;
      padding: 16px 32px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.3s;
    }
    .btn-primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #fff;
    }
    .btn-secondary {
      background: rgba(255,255,255,0.1);
      color: #94a3b8;
      border: 1px solid rgba(255,255,255,0.2);
    }
    .strict-info {
      display: none;
      background: rgba(102,126,234,0.1);
      border: 1px solid rgba(102,126,234,0.3);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 16px;
      font-size: 13px;
    }
    .strict-info.show {
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="brand-name">æ•°å­—å†…é˜</div>
      <div class="page-title">ä½ çš„ä¸“å±å››äººAIå›¢é˜Ÿ</div>
      <div class="page-subtitle">ç¬¬ä¸€æ¬¡æŠŠæ‰åç³»ç»ŸåŒ–ï¼Œæˆä¸ºå¼€åˆ›è€…</div>
    </div>
    
    <div class="input-section">
      <div class="input-header">
        <label>è¯·æè¿°æ‚¨çš„éœ€æ±‚</label>
        <label id="strict-label">
          <input type="checkbox" id="strict-mode">
          <span>ä¸¥æ ¼æ¨¡å¼</span>
        </label>
      </div>
      
      <div id="strict-info" class="strict-info">
        <strong style="color:#fbbf24">ä¸¥æ ¼æ¨¡å¼å·²å¼€å¯</strong>
        <ul style="margin:8px 0 0 16px;color:#94a3b8">
          <li>æ‰€æœ‰ç›®æ ‡å¿…é¡»é‡åŒ–</li>
          <li>æ¯ä¸ªæ­¥éª¤å¿…é¡»æœ‰éªŒæ”¶æ ‡å‡†</li>
          <li>èµ„æºå¿…é¡»æ˜ç¡®</li>
          <li>ç¦æ­¢ç©ºæ³›è¡¨è¿°</li>
        </ul>
      </div>
      
      <div class="file-upload-area" id="upload-area">
        <div style="font-size:48px;margin-bottom:12px">ğŸ“</div>
        <p style="color:#94a3b8">ç‚¹å‡»ä¸Šä¼ æ–‡ä»¶ï¼ˆå›¾ç‰‡/PDF/Wordï¼‰</p>
        <input type="file" id="file-input" style="display:none" multiple>
      </div>
      <div id="file-list"></div>
      
      <textarea id="user-input" placeholder="è¯·è¯¦ç»†æè¿°æ‚¨çš„éœ€æ±‚ï¼Œæˆ–ä¸Šä¼ æ–‡ä»¶ååœ¨æ­¤è¡¥å……è¯´æ˜..."></textarea>
      
      <div class="button-group">
        <button class="btn-primary" id="submit-btn">å¼€å§‹æ‰§è¡Œ</button>
        <button class="btn-secondary" id="reset-btn">é‡ç½®</button>
      </div>
    </div>
  </div>
  
  <script>
    // è·å–å…ƒç´ 
    var strictMode = document.getElementById('strict-mode');
    var strictInfo = document.getElementById('strict-info');
    var strictLabel = document.getElementById('strict-label');
    var uploadArea = document.getElementById('upload-area');
    var fileInput = document.getElementById('file-input');
    var fileList = document.getElementById('file-list');
    var userInput = document.getElementById('user-input');
    var submitBtn = document.getElementById('submit-btn');
    var resetBtn = document.getElementById('reset-btn');
    
    // ä¸¥æ ¼æ¨¡å¼åˆ‡æ¢
    strictMode.addEventListener('change', function() {
      if (strictMode.checked) {
        strictInfo.classList.add('show');
        strictLabel.style.color = '#fbbf24';
      } else {
        strictInfo.classList.remove('show');
        strictLabel.style.color = '#94a3b8';
      }
    });
    
    // æ–‡ä»¶ä¸Šä¼ 
    uploadArea.addEventListener('click', function() {
      fileInput.click();
    });
    
    fileInput.addEventListener('change', function(e) {
      var files = e.target.files;
      var html = '';
      for (var i = 0; i < files.length; i++) {
        html += '<div style="padding:8px;background:rgba(102,126,234,0.1);border-radius:8px;margin:4px 0">' + 
                files[i].name + ' (' + (files[i].size/1024).toFixed(1) + ' KB)</div>';
      }
      fileList.innerHTML = html;
    });
    
    // é‡ç½®æŒ‰é’®
    resetBtn.addEventListener('click', function() {
      userInput.value = '';
      fileList.innerHTML = '';
      fileInput.value = '';
      strictMode.checked = false;
      strictInfo.classList.remove('show');
      strictLabel.style.color = '#94a3b8';
      alert('å·²é‡ç½®');
    });
    
    // æäº¤æŒ‰é’®
    submitBtn.addEventListener('click', async function() {
      var text = userInput.value.trim();
      if (!text) {
        alert('è¯·è¾“å…¥éœ€æ±‚');
        return;
      }
      
      // ä¸¥æ ¼æ¨¡å¼å‰ç¼€
      if (strictMode.checked) {
        text = 'ã€ä¸¥æ ¼æ¨¡å¼ã€‘' + text;
      }
      
      submitBtn.disabled = true;
      submitBtn.textContent = 'æ‰§è¡Œä¸­...';
      
      try {
        // ä½¿ç”¨ç»å¯¹è·¯å¾„é¿å…é—®é¢˜
        var apiUrl = window.location.protocol + '//' + window.location.host + '/api/cabinet/run';
        
        var response = await fetch(apiUrl, {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify({ text: text })
        });
        
        if (!response.ok) {
          throw new Error('HTTP ' + response.status);
        }
        
        var data = await response.json();
        
        if (data.taskId) {
          alert('ä»»åŠ¡å·²åˆ›å»ºï¼ID: ' + data.taskId);
          localStorage.setItem('current_task', data.taskId);
        } else {
          alert('åˆ›å»ºå¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'));
        }
      } catch (e) {
        console.error(e);
        alert('è¯·æ±‚å¤±è´¥: ' + e.message + '\nè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
      }
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'å¼€å§‹æ‰§è¡Œ';
    });
  </script>
</body>
</html>
