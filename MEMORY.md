# 🧠 阿一的记忆库

## 🔒 绝对安全原则（2026-02-21 建立）

### 修改前自动备份
在 QQ 中让我修改任何服务器文件、配置文件或网站代码之前，**必须**先执行备份：

```bash
# 自动执行
bash /root/.openclaw/workspace/backup-diyici.sh
```

备份位置：`/root/.openclaw/workspace/backups/diyici_backup_YYYYMMDD_HHMMSS.tar.gz`
保留策略：保留最近 20 个备份

### 一键急救指令
如果用户在 QQ 里说：
> "⚠️网站崩了，立刻回滚"

**不要做任何 AI 分析**，直接执行：

```bash
bash /root/.openclaw/workspace/rollback-diyici.sh
```

该脚本会：
1. 停止 Node.js 后端
2. 备份当前状态
3. 恢复最近备份
4. 重新编译
5. 部署前端
6. 启动服务
7. 重启 Nginx

目标：1 分钟内恢复网站访问

---

## 🚨 安全事故记录（2026-02-22）

### API密钥泄露事件
**时间：** 2026-02-22 03:57  
**发现：** 腾讯云控制台提示密钥在Git上泄露

**泄露详情：**
- 文件：`server/ecosystem.config.js`
- 状态：明文硬编码API密钥，且已提交到Git历史
- 影响：腾讯云、Kimi、DeepSeek API密钥全部泄露

**应急处理：**
1. 立即从Git历史中删除文件（git filter-branch）
2. 强制推送清理后的历史
3. 更新配置文件，改用环境变量
4. 重启服务

**教训：**
- ❌ **永远不要**在代码中硬编码API密钥
- ✅ 使用环境变量或配置文件（.env）
- ✅ 将敏感文件加入 .gitignore
- ✅ 定期扫描Git历史检查敏感信息

**待办：**
- [ ] 更换腾讯云API密钥（紧急）
- [ ] 更换Kimi API Key（建议）
- [ ] 更换DeepSeek API Key（建议）

---

## ⚠️ AI幻觉问题记录（2026-02-22）

### 事件：数字内阁命理分析严重错误
**用户输入：** 紫微斗数命盘图片 + "此人今年运势"  
**AI输出：** 完整的2026年运势分析报告  
**问题：** 星曜位置全部编造

### AI幻觉机制分析

**错误表现：**
| 星曜 | AI声称位置 | 实际位置 | 错误后果 |
|------|-----------|---------|---------|
| 天同化禄 | 命宫 | 戌宫（兄弟宫） | 解读方向错误 |
| 天机化权 | 父母宫 | 寅宫（田宅宫） | 建议对象错误 |
| 廉贞化忌 | 子女宫 | **未宫（财帛宫）** | 最严重：财务风险被轻描淡写为"冲动消费" |

**根本原因：**
1. **LLM本质是"文本接龙"** - 不是真正理解，是预测下一个词
2. **OCR丢失空间维度** - 命盘是12宫格二维矩阵，OCR只能识别文字，无法保留位置关系
3. **"完成任务"强迫性** - AI为保持逻辑自洽，脑补数据填补空白
4. **虚假API调用** - YAML中`/ziwei/calculate`端点不存在，AI伪造返回数据

### 解决方案

**系统提示词v3.0新增：**
1. **命理分析铁律** - 绝对禁止编造星曜位置
2. **强制警告** - 每份分析开头必须声明"AI可能误读，请咨询专业命理师"
3. **YAML规范** - 禁止虚假API端点，使用占位符

**长期建议：**
- 禁用需要精确结构化数据的分析类型
- 或接入真实排盘API（如文墨天机）
- 或改为AI只出框架，数据由专业人士填写

### 教训
- LLM在专业领域极易产生幻觉
- 不要高估AI的专业知识能力
- 涉及用户重大决策（财务、健康、命理）必须谨慎

---

## 📝 重要项目信息

### Diyici.ai 网站
- **源码目录**: `/root/.openclaw/workspace/diyici-source`
- **部署目录**: `/var/www/diyici.ai`
- **后端服务**: Node.js (端口 3000)
- **反向代理**: Nginx
- **数据库**: SQLite

### API Keys（环境变量中）
- Kimi API
- DeepSeek API
- 腾讯云 OCR

### 服务器规格
- CPU: 2核 AMD EPYC
- 内存: 2GB
- 磁盘: 50GB SSD
- 系统: OpenCloudOS 9.4
