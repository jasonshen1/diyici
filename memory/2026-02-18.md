# 2026-02-18 工作日志

## 钉钉部署问题记录

### 问题描述
尝试将 OpenClaw 部署到钉钉，机器人添加成功但消息无响应。

### 排查过程

1. **初始配置**
   - AppKey: `dingfaa9f4d19abc670bffe93478753d9884`
   - 配置了 channels.ddingtalk.enabled = true
   - 但插件未启用: plugins.entries.ddingtalk.enabled = false

2. **修复插件启用状态**
   - 修复后 Gateway 重启成功
   - 但 Stream 连接失败: 401 Unauthorized

3. **根本原因**
   - AppSecret 可能不正确或已过期
   - 或应用未发布导致凭证无效

### 当前状态
- Gateway 运行正常
- 钉钉插件已启用
- Stream 连接 401 错误（等待正确凭证）

### 更新：文件接收问题解决

**问题：** 用户发送 xlsx 文件，机器人无响应

**排查结果：**
- 钉钉扩展代码支持文件接收（monitor.ts 中有 fileMessageHandler）
- 但钉钉应用需要开通特定权限才能获取文件下载链接

**解决方案：**
需要在钉钉开发者后台开通权限：
1. **根据 downloadCode 获取机器人接收消息的下载链接** - 接收图片/文件/语音必备
2. 企业内机器人发送消息权限
3. 机器人使用成员范围授权

**注意：** 修改权限后需要重新发布应用才能生效

### 待办
- [ ] 用户确认钉钉开发者后台的 AppKey 和 AppSecret
- [ ] 确认应用已发布（非草稿状态）
- [ ] 开通文件下载权限（根据 downloadCode 获取下载链接）
- [ ] 重新发布后测试文件接收

### 相关配置参考
```json
{
  "channels": {
    "ddingtalk": {
      "enabled": true,
      "clientId": "ding...",
      "clientSecret": "...",
      "allowFrom": ["*"]
    }
  },
  "plugins": {
    "entries": {
      "ddingtalk": {
        "enabled": true
      }
    }
  }
}
```

## 其他工作

### XHS-Deep-Decoder Skill
- 已保存 v5.0 版本到 workspace/skills/xhs-deep-decoder/SKILL.md
- 支持智能切换：图文用v4，视频用v5
- 支持手动触发: /decode, /decode-v4, /decode-v5

### 多渠道对比总结
| 平台 | 难度 | 特点 |
|-----|-----|------|
| 钉钉 | ⭐ 最简单 | Stream模式，无需公网IP |
| Discord | ⭐⭐ 简单 | 功能最全，国际化 |
| QQ | ⭐⭐⭐ 中等 | 国内用户多，功能简单 |
| 飞书 | ⭐⭐⭐ 较复杂 | 生态完善，配置项多 |
