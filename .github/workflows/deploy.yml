name: 构建和上传产物
on:
  push:
    branches: [ master ]
  workflow_dispatch:
    branches: [ master ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: 下载代码
        uses: actions/checkout@v4
      - name: 安装 Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
      - name: 安装依赖
        run: npm install
      - name: 构建项目
        run: npm run build
      - name: 检查构建结果
        run: |
          echo "检查构建结果..."
          if [ ! -d "./dist" ]; then
            echo "错误: dist 目录不存在"
            exit 1
          fi
          if [ -z "$(ls -A ./dist)" ]; then
            echo "错误: dist 目录为空"
            exit 1
          fi
          echo "构建成功！dist 目录内容:"
          ls -la ./dist
      - name: 上传构建产物
        uses: actions/upload-artifact@v4
        with:
          name: diyici-build
          path: ./dist
          retention-days: 7
      - name: 部署说明
        run: |
          echo "=== 构建完成 ==="
          echo "构建产物已上传到 GitHub Actions Artifacts"
          echo "请按照以下步骤手动部署:"
          echo "1. 在 GitHub Actions 页面下载构建产物 (diyici-build.zip)"
          echo "2. 解压构建产物"
          echo "3. 将解压后的文件上传到您的腾讯云服务器"
          echo "4. 服务器地址: ${{ secrets.DEPLOY_HOST }}"
          echo "5. 用户名: ${{ secrets.DEPLOY_USER }}"
          echo "6. 部署路径: ${{ secrets.DEPLOY_PATH }}"
          echo ""
          echo "示例命令:"
          echo "scp -r ./dist/* ${{ secrets.DEPLOY_USER }}@${{ secrets.DEPLOY_HOST }}:${{ secrets.DEPLOY_PATH }}"
          echo ""
          echo "或使用 FTP 客户端 (如 FileZilla) 上传文件"

